<!doctype html><html lang="en">
 <head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <meta content="#3c790a" name="theme-color">
  <title>WebSockets Standard</title>
  <link crossorigin href="https://resources.whatwg.org/spec.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/standard.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/standard-shared-with-dev.css" rel="stylesheet">
  <link crossorigin href="https://resources.whatwg.org/logo-websockets.svg" rel="icon">
<script async crossorigin src="https://resources.whatwg.org/file-issue.js"></script>
<script async crossorigin src="https://resources.whatwg.org/commit-snapshot-shortcut-key.js"></script>
  <meta content="Bikeshed version 40de15f9, updated Thu Jun 11 17:47:04 2020 -0700" name="generator">
  <meta content="05b83d8ff5e4373ea41fa721252014efc35c8b69" name="document-revision">
<style>/* style-dfn-panel */

.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: #DDDDDD;
    color: black;
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: black; }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
 <body class="h-entry status-LS">
  <div class="head">
    <a class="logo" href="https://whatwg.org/"> <img alt="WHATWG" crossorigin height="100" src="https://resources.whatwg.org/logo-websockets.svg"> </a> 
   <hgroup>
    <h1 class="p-name no-ref" id="title">WebSockets</h1>
    <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Living Standard — Last Updated <time class="dt-updated" datetime="2021-03-03">3 March 2021</time></span></h2>
   </hgroup>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Participate:
     <dd><a href="https://github.com/whatwg/websockets">GitHub whatwg/websockets</a> (<a href="https://github.com/whatwg/websockets/issues/new">new issue</a>, <a href="https://github.com/whatwg/websockets/issues">open issues</a>)
     <dd><a href="https://wiki.whatwg.org/wiki/IRC">IRC: #whatwg on Freenode</a>
     <dt>Commits:
     <dd><a href="https://github.com/whatwg/websockets/commits">GitHub whatwg/websockets/commits</a>
     <dd><a copy href="/commit-snapshots/LOCAL" id="commit-snapshot-link">Snapshot as of this commit</a>
     <dd><a href="https://twitter.com/whatsockets">@whatsockets</a>
     <dt>Tests:
     <dd><a href="https://github.com/web-platform-tests/wpt/tree/master/websockets">web-platform-tests websockets/</a> (<a href="https://github.com/web-platform-tests/wpt/labels/websockets">ongoing work</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This specification provides APIs to enable web applications to maintain bidirectional

communications with server-side processes.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#network-intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#websocket-protocol"><span class="secno">2</span> <span class="content">WebSocket protocol alterations</span></a>
     <ol class="toc">
      <li><a href="#websocket-connections"><span class="secno">2.1</span> <span class="content">Connections</span></a>
      <li><a href="#websocket-opening-handshake"><span class="secno">2.2</span> <span class="content">Opening handshake</span></a>
     </ol>
    <li>
     <a href="#the-websocket-interface"><span class="secno">3</span> <span class="content">The <code class="idl"><span>WebSocket</span></code> interface</span></a>
     <ol class="toc">
      <li><a href="#interface-definition"><span class="secno">3.1</span> <span class="content">Interface definition</span></a>
     </ol>
    <li><a href="#feedback-from-the-protocol"><span class="secno">4</span> <span class="content">Feedback from the protocol</span></a>
    <li><a href="#ping-and-pong-frames"><span class="secno">5</span> <span class="content">Ping and Pong frames</span></a>
    <li><a href="#the-closeevent-interface"><span class="secno">6</span> <span class="content">The <code class="idl"><span>CloseEvent</span></code> interface</span></a>
    <li><a href="#garbage-collection"><span class="secno">7</span> <span class="content">Garbage collection</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="network-intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#network-intro"></a></h2>
   <div class="non-normative">
    <p><em>This section is non-normative.</em></p>
    <p>To enable web applications to maintain bidirectional communications with server-side processes,
this specification introduces the <code>WebSocket</code> interface.</p>
    <p class="note" role="note">This interface does not allow for raw access to the underlying network. For
example, this interface could not be used to implement an IRC client without proxying messages
through a custom server.</p>
   </div>
   <h2 class="heading settled" data-level="2" id="websocket-protocol"><span class="secno">2. </span><span class="content">WebSocket protocol alterations</span><a class="self-link" href="#websocket-protocol"></a></h2>
   <div class="note" role="note">
     This section replaces part of the WebSocket protocol opening handshake client requirement to
 integrate it with algorithms defined in Fetch. This way CSP, cookies, HSTS, and other Fetch-related
 protocols are handled in a single location. Ideally the RFC would be updated with this language,
 but it is never that easy. The WebSocket API, defined in the HTML Standard, has been updated to use
 this language. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> <a data-link-type="biblio" href="#biblio-html">[HTML]</a> 
    <p>The way this works is by replacing The WebSocket Protocol’s "establish a WebSocket connection"
 algorithm with a new one that integrates with Fetch. "Establish a WebSocket connection" consists of
 three algorithms: setting up a connection, creating and transmiting a handshake request, and
 validating the handshake response. That layering is different from Fetch, which first creates a
 handshake, then sets up a connection and transmits the handshake, and finally validates the
 response. Keep that in mind while reading these alterations.</p>
   </div>
   <h3 class="heading settled" data-level="2.1" id="websocket-connections"><span class="secno">2.1. </span><span class="content">Connections</span><a class="self-link" href="#websocket-connections"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="concept-websocket-connection-obtain">obtain a WebSocket connection</dfn>, given a <var>url</var>, run these steps:</p>
   <ol>
    <li data-md>
     <p>Let <var>host</var> be <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-host" id="ref-for-concept-url-host">host</a>.</p>
    <li data-md>
     <p>Let <var>port</var> be <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-port" id="ref-for-concept-url-port">port</a>.</p>
    <li data-md>
     <p>Let <var>secure</var> be false, if <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme">scheme</a> is
"<code>http</code>", and true otherwise.</p>
    <li data-md>
     <p>Follow the requirements stated in step 2 to 5, inclusive, of the first set of steps in <a href="http://tools.ietf.org/html/rfc6455#section-4.1">section 4.1</a> of The WebSocket Protocol
to establish a <a data-link-type="dfn" href="#concept-websocket-connection-obtain" id="ref-for-concept-websocket-connection-obtain">WebSocket connection</a>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
    <li data-md>
     <p>If that established a connection, return it, and return failure otherwise.</p>
   </ol>
   <p class="note" role="note">Although structured a little differently, carrying different properties, and
therefore not shareable, a WebSocket connection is very close to identical to an "ordinary" <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-connection" id="ref-for-concept-connection">connection</a>. </p>
   <h3 class="heading settled" data-level="2.2" id="websocket-opening-handshake"><span class="secno">2.2. </span><span class="content">Opening handshake</span><a class="self-link" href="#websocket-opening-handshake"></a></h3>
   <p>To <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="concept-websocket-establish">establish a WebSocket connection</dfn>, given a <var>url</var>, <var>protocols</var>, and <var>client</var>, run these steps:</p>
   <ol>
    <li data-md>
     <p>Let <var>requestURL</var> be a copy of <var>url</var>, with its <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme①">scheme</a> set to
"<code>http</code>", if <var>url</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme②">scheme</a> is "<code>ws</code>", and to
"<code>https</code>" otherwise.</p>
     <p class="note no-backref" role="note">This change of scheme is essential to integrate well with <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch">fetching</a>. E.g., HSTS would not work without it. There is no real
reason for WebSocket to have distinct schemes, it’s a legacy artefact. <a data-link-type="biblio" href="#biblio-hsts">[HSTS]</a> </p>
    <li data-md>
     <p>Let <var>request</var> be a new <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request" id="ref-for-concept-request">request</a>, whose <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-url" id="ref-for-concept-request-url">URL</a> is <var>requestURL</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-client" id="ref-for-concept-request-client">client</a> is <var>client</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#request-service-workers-mode" id="ref-for-request-service-workers-mode">service-workers mode</a> is "<code>none</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-referrer" id="ref-for-concept-request-referrer">referrer</a> is "<code>no-referrer</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-mode" id="ref-for-concept-request-mode">mode</a> is "<code>websocket</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode" id="ref-for-concept-request-credentials-mode">credentials mode</a> is
"<code>include</code>", <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-cache-mode" id="ref-for-concept-request-cache-mode">cache mode</a> is "<code>no-store</code>", and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode" id="ref-for-concept-request-redirect-mode">redirect mode</a> is "<code>error</code>".</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append">Append</a> `<code>Upgrade</code>`/`<code>websocket</code>` to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list">header list</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append①">Append</a> `<code>Connection</code>`/`<code>Upgrade</code>` to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list①">header list</a>.</p>
    <li data-md>
     <p>Let <var>keyValue</var> be a nonce consisting of a randomly selected 16-byte value that has
been <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#forgiving-base64-encode" id="ref-for-forgiving-base64-encode">forgiving-base64-encoded</a> and <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#isomorphic-encode" id="ref-for-isomorphic-encode">isomorphic encoded</a>.</p>
     <p class="example" id="example-random-value"><a class="self-link" href="#example-random-value"></a>If the randomly selected value was the byte sequence 0x01
 0x02 0x03 0x04 0x05 0x06 0x07 0x08 0x09 0x0a 0x0b 0x0c 0x0d 0x0e 0x0f 0x10, <var>keyValue</var> would be forgiving-base64-encoded to "<code>AQIDBAUGBwgJCgsMDQ4PEC==</code>" and isomorphic encoded to
 `<code>AQIDBAUGBwgJCgsMDQ4PEC==</code>`. </p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append②">Append</a> `<code>Sec-WebSocket-Key</code>`/<var>keyValue</var> to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list②">header list</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append③">Append</a> `<code>Sec-WebSocket-Version</code>`/`<code>13</code>` to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list③">header list</a>.</p>
    <li data-md>
     <p>For each <var>protocol</var> in <var>protocols</var>, <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-combine" id="ref-for-concept-header-list-combine">combine</a> `<code>Sec-WebSocket-Protocol</code>`/<var>protocol</var> in <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list④">header
list</a>.</p>
    <li data-md>
     <p>Let <var>permessageDeflate</var> be a user-agent defined "<code>permessage-deflate</code>"
extension <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header" id="ref-for-concept-header">header</a> <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-value" id="ref-for-concept-header-value">value</a>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
     <p class="example" id="example-permessage-deflate"><a class="self-link" href="#example-permessage-deflate"></a>`<code>permessage-deflate; client_max_window_bits</code>` </p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-header-list-append" id="ref-for-concept-header-list-append④">Append</a> `<code>Sec-WebSocket-Extensions</code>`/<var>permessageDeflate</var> to <var>request</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list⑤">header list</a>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-fetch" id="ref-for-concept-fetch①">Fetch</a> <var>request</var> with <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#fetch-useparallelqueue" id="ref-for-fetch-useparallelqueue"><i>useParallelQueue</i></a> set to true, and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#process-response" id="ref-for-process-response"><i>processResponse</i></a> given <var>response</var> being these
steps:</p>
     <ol>
      <li data-md>
       <p>If <var>response</var> is a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-network-error" id="ref-for-concept-network-error">network error</a> or its <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response-status" id="ref-for-concept-response-status">status</a> is not
101, <a data-link-type="dfn" href="#fail-the-websocket-connection" id="ref-for-fail-the-websocket-connection">fail the WebSocket connection</a>.</p>
      <li data-md>
       <p>If <var>protocols</var> is not the empty list and <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#extract-header-list-values" id="ref-for-extract-header-list-values">extracting header list values</a> given
 `<code>Sec-WebSocket-Protocol</code>` and <var>response</var>’s <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-request-header-list" id="ref-for-concept-request-header-list⑥">header list</a> results in null, failure, or the empty byte sequence, then <a data-link-type="dfn" href="#fail-the-websocket-connection" id="ref-for-fail-the-websocket-connection①">fail the WebSocket connection</a>.</p>
       <p class="note" role="note">This is different from the check on this header defined by The WebSocket Protocol.
That only covers a subprotocol not requested by the client. This covers a subprotocol requested
by the client, but not acknowledged by the server. </p>
      <li data-md>
       <p>Follow the requirements stated step 2 to step 6, inclusive, of the last set of steps in <a href="http://tools.ietf.org/html/rfc6455#section-4.1">section 4.1</a> of The WebSocket Protocol
to validate <var>response</var>. This either results in <a data-link-type="dfn" href="#fail-the-websocket-connection" id="ref-for-fail-the-websocket-connection②">fail the WebSocket connection</a> or <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established">the WebSocket connection is established</a>.</p>
     </ol>
   </ol>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="fail-the-websocket-connection">Fail the WebSocket connection</dfn> and <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="the-websocket-connection-is-established">the WebSocket connection is established</dfn> are defined by The WebSocket Protocol. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
   <p class="warning">The reason redirects are not followed and this handshake is generally restricted is
because it could introduce serious security problems in a web browser context. For example, consider
a host with a WebSocket server at one path and an open HTTP redirector at another. Suddenly, any
script that can be given a particular WebSocket URL can be tricked into communicating to (and
potentially sharing secrets with) any host on the internet, even if the script checks that the URL
has the right hostname. </p>
   <h2 class="heading settled" data-level="3" id="the-websocket-interface"><span class="secno">3. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket">WebSocket</a></code> interface</span><a class="self-link" href="#the-websocket-interface"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="interface-definition"><span class="secno">3.1. </span><span class="content">Interface definition</span><a class="self-link" href="#interface-definition"></a></h3>
   <p>The Web IDL definition for the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①">WebSocket</a></code> class is given as follows:</p>
<pre class="idl highlight def"><c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-binarytype"><code><c- g>BinaryType</c-></code></dfn> { <dfn class="idl-code" data-dfn-for="BinaryType" data-dfn-type="enum-value" data-export id="dom-binarytype-blob"><code><c- s>"blob"</c-></code><a class="self-link" href="#dom-binarytype-blob"></a></dfn>, <dfn class="idl-code" data-dfn-for="BinaryType" data-dfn-type="enum-value" data-export id="dom-binarytype-arraybuffer"><code><c- s>"arraybuffer"</c-></code><a class="self-link" href="#dom-binarytype-arraybuffer"></a></dfn> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="websocket"><code><c- g>WebSocket</c-></code></dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget" id="ref-for-eventtarget"><c- n>EventTarget</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-websocket-websocket" id="ref-for-dom-websocket-websocket"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString"><c- b>USVString</c-></a> <dfn class="idl-code" data-dfn-for="WebSocket/WebSocket(url, protocols), WebSocket/constructor(url, protocols), WebSocket/WebSocket(url), WebSocket/constructor(url)" data-dfn-type="argument" data-export id="dom-websocket-websocket-url-protocols-url"><code><c- g>url</c-></code><a class="self-link" href="#dom-websocket-websocket-url-protocols-url"></a></dfn>, <c- b>optional</c-> (<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <c- b>or</c-> <c- b>sequence</c->&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString①"><c- b>DOMString</c-></a>>) <dfn class="idl-code" data-dfn-for="WebSocket/WebSocket(url, protocols), WebSocket/constructor(url, protocols), WebSocket/WebSocket(url), WebSocket/constructor(url)" data-dfn-type="argument" data-export id="dom-websocket-websocket-url-protocols-protocols"><code><c- g>protocols</c-></code><a class="self-link" href="#dom-websocket-websocket-url-protocols-protocols"></a></dfn> = []);
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString①"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="USVString" href="#dom-websocket-url" id="ref-for-dom-websocket-url"><c- g>url</c-></a>;

  // ready state
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="const" data-export id="dom-websocket-connecting"><code><c- g>CONNECTING</c-></code></dfn> = 0;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short①"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="idl-code" data-dfn-for="WebSocket" data-dfn-type="const" data-export id="dom-websocket-open"><code><c- g>OPEN</c-></code><a class="self-link" href="#dom-websocket-open"></a></dfn> = 1;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short②"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="const" data-export id="dom-websocket-closing"><code><c- g>CLOSING</c-></code></dfn> = 2;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short③"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="const" data-export id="dom-websocket-closed"><code><c- g>CLOSED</c-></code></dfn> = 3;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short④"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned short" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate"><c- g>readyState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long-long" id="ref-for-idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned long long" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount"><c- g>bufferedAmount</c-></a>;

  // networking
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onopen" id="ref-for-dom-websocket-onopen"><c- g>onopen</c-></a>;
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler①"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onerror" id="ref-for-dom-websocket-onerror"><c- g>onerror</c-></a>;
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler②"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onclose" id="ref-for-dom-websocket-onclose"><c- g>onclose</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString②"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-websocket-extensions" id="ref-for-dom-websocket-extensions"><c- g>extensions</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString③"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-websocket-protocol" id="ref-for-dom-websocket-protocol"><c- g>protocol</c-></a>;
  <a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-undefined" id="ref-for-idl-undefined"><c- n>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-websocket-close" id="ref-for-dom-websocket-close"><c- g>close</c-></a>(<c- b>optional</c-> [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Clamp" id="ref-for-Clamp"><c- g>Clamp</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short⑤"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="idl-code" data-dfn-for="WebSocket/close(code, reason), WebSocket/close(code), WebSocket/close()" data-dfn-type="argument" data-export id="dom-websocket-close-code-reason-code"><code><c- g>code</c-></code><a class="self-link" href="#dom-websocket-close-code-reason-code"></a></dfn>, <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString②"><c- b>USVString</c-></a> <dfn class="idl-code" data-dfn-for="WebSocket/close(code, reason), WebSocket/close(code), WebSocket/close()" data-dfn-type="argument" data-export id="dom-websocket-close-code-reason-reason"><code><c- g>reason</c-></code><a class="self-link" href="#dom-websocket-close-code-reason-reason"></a></dfn>);

  // messaging
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler③"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onmessage" id="ref-for-dom-websocket-onmessage"><c- g>onmessage</c-></a>;
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="#enumdef-binarytype" id="ref-for-enumdef-binarytype"><c- n>BinaryType</c-></a> <a class="idl-code" data-link-type="attribute" data-type="BinaryType" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype"><c- g>binaryType</c-></a>;
  <a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-undefined" id="ref-for-idl-undefined①"><c- n>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-websocket-send" id="ref-for-dom-websocket-send"><c- g>send</c-></a>((<a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource" id="ref-for-BufferSource"><c- n>BufferSource</c-></a> <c- b>or</c-> <a class="n" data-link-type="idl-name" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob"><c- n>Blob</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString③"><c- b>USVString</c-></a>) <dfn class="idl-code" data-dfn-for="WebSocket/send(data)" data-dfn-type="argument" data-export id="dom-websocket-send-data-data"><code><c- g>data</c-></code><a class="self-link" href="#dom-websocket-send-data-data"></a></dfn>);
};
</pre>
   <p>Each <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②">WebSocket</a></code> object has an associated <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="url">url</dfn> (a <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">URL record</a>).</p>
   <dl class="domintro non-normative">
    <dt><code><var>socket</var> = new <code class="idl"><a data-link-type="idl" href="#dom-websocket-websocket" id="ref-for-dom-websocket-websocket①">WebSocket</a></code>(<var>url</var> [, <var>protocols</var> ] )</code> 
    <dd>
     <p>Creates a new <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket③">WebSocket</a></code> object, immediately establishing the associated
  WebSocket connection. </p>
     <p><var>url</var> is a string giving the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">URL</a> over which the connection is
  established. Only "<code>ws</code>" or "<code>wss</code>" schemes are allowed; others will cause a
  "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror" id="ref-for-syntaxerror">SyntaxError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException">DOMException</a></code>. URLs with <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment">fragments</a> will also cause such an exception. </p>
     <p><var>protocols</var> is either a string or an array of strings. If it is a string, it is
  equivalent to an array consisting of just that string; if it is omitted, it is equivalent to the
  empty array. Each string in the array is a subprotocol name. The connection will only be
  established if the server reports that it has selected one of these subprotocols. The subprotocol
  names have to match the requirements for elements that comprise the value of <code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-11.3.4" id="ref-for-section-11.3.4">Sec-WebSocket-Protocol</a></code> fields as defined by The WebSocket protocol. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
    <dt><code><var>socket</var> . <a class="idl-code" data-link-type="method" href="#dom-websocket-send" id="ref-for-dom-websocket-send①">send</a>( <var>data</var> )</code> 
    <dd>
     <p>Transmits <var>data</var> using the WebSocket connection. <var>data</var> can be a string, a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob①">Blob</a></code>, an <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer">ArrayBuffer</a></code>, or an <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#ArrayBufferView" id="ref-for-ArrayBufferView">ArrayBufferView</a></code>. </p>
    <dt><code><var>socket</var> . <a class="idl-code" data-link-type="method" href="#dom-websocket-close" id="ref-for-dom-websocket-close①">close</a>( [ <var>code</var> ] [, <var>reason</var> ] )</code> 
    <dd>
     <p>Closes the WebSocket connection, optionally using <var>code</var> as the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.5" id="ref-for-section-7.1.5">the WebSocket
  connection close code</a> and <var>reason</var> as the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.6" id="ref-for-section-7.1.6">the WebSocket connection close reason</a>. </p>
    <dt><code><var>socket</var> . <a class="idl-code" data-link-type="attribute" href="#dom-websocket-url" id="ref-for-dom-websocket-url①">url</a></code> 
    <dd>
     <p>Returns the <a data-link-type="dfn" href="#url" id="ref-for-url">URL that was used</a> to establish the WebSocket connection. </p>
    <dt><code><var>socket</var> . <a class="idl-code" data-link-type="attribute" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate①">readyState</a></code> 
    <dd>
     <p>Returns the state of the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket④">WebSocket</a></code> object’s connection. It can have the values
  described below. </p>
    <dt><code><var>socket</var> . <a class="idl-code" data-link-type="attribute" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount①">bufferedAmount</a></code> 
    <dd>
     <p>Returns the number of bytes of application data (UTF-8 text and binary data) that have been
  queued using <code class="idl"><a data-link-type="idl" href="#dom-websocket-send" id="ref-for-dom-websocket-send②">send()</a></code> but not yet been transmitted to the network. </p>
     <p>If the WebSocket connection is closed, this attribute’s value will only increase with each call
  to the <code class="idl"><a data-link-type="idl" href="#dom-websocket-send" id="ref-for-dom-websocket-send③">send()</a></code> method. (The number does not reset to zero once the connection
  closes.) </p>
    <dt><code><var>socket</var> . <a class="idl-code" data-link-type="attribute" href="#dom-websocket-extensions" id="ref-for-dom-websocket-extensions①">extensions</a></code> 
    <dd>
     <p>Returns the extensions selected by the server, if any. </p>
    <dt><code><var>socket</var> . <a class="idl-code" data-link-type="attribute" href="#dom-websocket-protocol" id="ref-for-dom-websocket-protocol①">protocol</a></code> 
    <dd>
     <p>Returns the subprotocol selected by the server, if any. It can be used in conjunction with the
  array form of the constructor’s second argument to perform subprotocol negotiation. </p>
    <dt><code><var>socket</var> . <a class="idl-code" data-link-type="attribute" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype①">binaryType</a> [ = <var>value</var> ]</code> 
    <dd>
     <p>Returns a string that indicates how binary data from the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑤">WebSocket</a></code> object is
  exposed to scripts: </p>
     <dl>
      <dt>"<a data-link-type="dfn" href="#blob" id="ref-for-blob"><code>blob</code></a>" 
      <dd>
       <p>Binary data is returned in <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob②">Blob</a></code> form. </p>
      <dt>"<a data-link-type="dfn" href="#arraybuffer" id="ref-for-arraybuffer"><code>arraybuffer</code></a>" 
      <dd>
       <p>Binary data is returned in <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer①">ArrayBuffer</a></code> form. </p>
     </dl>
     <p>Can be set, to change how binary data is returned. The default is "<code>blob</code>" </p>
   </dl>
   <div class="algorithm" data-algorithm="WebSocket(url, protocols)" data-algorithm-for="WebSocket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="constructor" data-export data-lt="WebSocket(url, protocols)|constructor(url, protocols)|WebSocket(url)|constructor(url)" id="dom-websocket-websocket"><code>WebSocket(<var>url</var>, <var>protocols</var>)</code></dfn> constructor, when invoked, must run these steps: </p>
    <ol>
     <li data-md>
      <p>Let <var>urlRecord</var> be the result of applying the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-parser" id="ref-for-concept-url-parser">URL parser</a> to <var>url</var>.</p>
     <li data-md>
      <p>If <var>urlRecord</var> is failure, then throw a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror" id="ref-for-syntaxerror①">SyntaxError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException①">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>urlRecord</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-scheme" id="ref-for-concept-url-scheme③">scheme</a> is not "<code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-11.1.1" id="ref-for-section-11.1.1">ws</a></code>" or "<code><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-11.1.2" id="ref-for-section-11.1.2">wss</a></code>", then throw a
  "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror" id="ref-for-syntaxerror②">SyntaxError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException②">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>urlRecord</var>’s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-fragment" id="ref-for-concept-url-fragment①">fragment</a> is non-null, then throw a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror" id="ref-for-syntaxerror③">SyntaxError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException③">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>protocols</var> is a string, set <var>protocols</var> to a sequence consisting of just that string.</p>
     <li data-md>
      <p>If any of the values in <var>protocols</var> occur more than once or otherwise fail to match the
  requirements for elements that comprise the value of <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-11.3.4" id="ref-for-section-11.3.4①"><code>Sec-WebSocket-Protocol</code></a> fields as defined by The WebSocket protocol, then throw a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror" id="ref-for-syntaxerror④">SyntaxError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException④">DOMException</a></code>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
     <li data-md>
      <p>Run this step <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel">in parallel</a>:</p>
      <ol>
       <li data-md>
        <p><a data-link-type="dfn" href="#concept-websocket-establish" id="ref-for-concept-websocket-establish">Establish a WebSocket connection</a> given <var>urlRecord</var>, <var>protocols</var>, and the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object" id="ref-for-entry-settings-object">entry settings
  object</a>.</p>
        <p class="note" role="note">If the <a data-link-type="dfn" href="#concept-websocket-establish" id="ref-for-concept-websocket-establish①">establish a WebSocket connection</a> algorithm
  fails, it triggers the <a data-link-type="dfn" href="#fail-the-websocket-connection" id="ref-for-fail-the-websocket-connection③">fail the WebSocket connection</a> algorithm, which
  then invokes the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.1" id="ref-for-section-7.1.1">close the WebSocket connection</a> algorithm, which then
  establishes that <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.4" id="ref-for-section-7.1.4">the WebSocket connection is closed</a>, which fires the <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close"><code>close</code></a> event <a href="#closeWebSocket">as described below</a>. </p>
      </ol>
     <li data-md>
      <p>Return a new <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑥">WebSocket</a></code> object whose <a data-link-type="dfn" href="#url" id="ref-for-url①">url</a> is <var>urlRecord</var>.</p>
    </ol>
   </div>
   <hr>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-url"><code>url</code></dfn> attribute’s getter must return this <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑦">WebSocket</a></code> object’s <a data-link-type="dfn" href="#url" id="ref-for-url②">url</a>, <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer">serialized</a>.</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-readystate"><code>readyState</code></dfn> attribute represents the state of
the connection. It can have the following values:</p>
   <dl>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="connecting"><code>CONNECTING</code></dfn> (numeric value 0)
    <dd data-md>
     <p>The connection has not yet been established.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="open"><code>OPEN</code></dfn> (numeric value 1)
    <dd data-md>
     <p><a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established①">The WebSocket connection is established</a> and communication is possible.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="closing"><code>CLOSING</code></dfn> (numeric value 2)
    <dd data-md>
     <p>The connection is going through the
closing handshake, or the <code class="idl"><a data-link-type="idl" href="#dom-websocket-close" id="ref-for-dom-websocket-close②">close()</a></code> method has been invoked.</p>
    <dt data-md><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="closed"><code>CLOSED</code></dfn> (numeric value 3)
    <dd data-md>
     <p>The connection has been closed or could not be opened.</p>
   </dl>
   <p>When the object is created its <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate②">readyState</a></code> must be set to <code class="idl"><a data-link-type="idl" href="#dom-websocket-connecting" id="ref-for-dom-websocket-connecting">CONNECTING</a></code> (0).</p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-extensions"><code>extensions</code></dfn> attribute must initially return
the empty string. After <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established②">the WebSocket connection is established</a>, its value might change, as
defined below.</p>
   <p></p>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-protocol"><code>protocol</code></dfn> attribute must initially return the
empty string. After <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established③">the WebSocket connection is established</a>, its value might change, as defined
below.</p>
   <div class="algorithm" data-algorithm="close(code, reason)" data-algorithm-for="WebSocket">
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="method" data-export data-lt="close(code, reason)|close(code)|close()" id="dom-websocket-close"><code>close(<var>code</var>, <var>reason</var>)</code></dfn> method, when invoked, must run these steps: </p>
    <ol>
     <li data-md>
      <p>If <var>code</var> is present, but is neither an integer equal to 1000 nor an integer in the range 3000
  to 4999, inclusive, throw an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidaccesserror" id="ref-for-invalidaccesserror">InvalidAccessError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑤">DOMException</a></code>.</p>
     <li data-md>
      <p>If <var>reason</var> is present, then run these substeps:</p>
      <ol>
       <li data-md>
        <p>Let <var>reasonBytes</var> be the result of <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-encode" id="ref-for-utf-8-encode">encoding</a> <var>reason</var>.</p>
       <li data-md>
        <p>If <var>reasonBytes</var> is longer than 123 bytes, then throw a "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#syntaxerror" id="ref-for-syntaxerror⑤">SyntaxError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑥">DOMException</a></code>.</p>
      </ol>
     <li data-md>
      <p>Run the first matching steps from the following list:</p>
      <dl class="switch">
       <dt data-md>If the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate③">readyState</a></code> attribute is in the <code class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing">CLOSING</a></code> (2) or <code class="idl"><a data-link-type="idl" href="#dom-websocket-closed" id="ref-for-dom-websocket-closed">CLOSED</a></code> (3) state
       <dd data-md>
        <p>Do nothing. </p>
        <p class="note" role="note">The connection is already closing or is already closed. If it has not already, a <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close①"><code>close</code></a> event will eventually fire <a href="#closeWebSocket">as described
below</a>. </p>
       <dt data-md>If the WebSocket connection is not yet <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and">established</a> <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a>
       <dd data-md>
        <p><a data-link-type="dfn" href="#fail-the-websocket-connection" id="ref-for-fail-the-websocket-connection④">Fail the WebSocket connection</a> and set the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate④">readyState</a></code> attribute’s value to <code class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing①">CLOSING</a></code> (2). <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
        <p class="note" role="note">The <a data-link-type="dfn" href="#fail-the-websocket-connection" id="ref-for-fail-the-websocket-connection⑤">fail the WebSocket connection</a> algorithm invokes the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.1" id="ref-for-section-7.1.1①">close the WebSocket
connection</a> algorithm, which then establishes that <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.4" id="ref-for-section-7.1.4①">the WebSocket connection is closed</a>, which
fires the <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close②"><code>close</code></a> event <a href="#closeWebSocket">as described below</a>. </p>
       <dt data-md>If the WebSocket closing handshake has not yet been <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3">started</a>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a>
       <dd data-md>
        <p><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.2" id="ref-for-section-7.1.2">Start the WebSocket closing handshake</a> and set the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate⑤">readyState</a></code> attribute’s value to <code class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing②">CLOSING</a></code> (2). <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
        <p>If neither <var>code</var> nor <var>reason</var> is present, the WebSocket Close message must not have a body. </p>
        <p class="note" role="note">The WebSocket Protocol erroneously states that the status code is <span class="allow-2119">required for the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.2" id="ref-for-section-7.1.2①">start the WebSocket closing handshake</a> algorithm. </span></p>
        <p>If <var>code</var> is present, then the status code to use in the
WebSocket Close message must be the integer given by <var>code</var>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
        <p>If <var>reason</var> is also present, then <var>reasonBytes</var> must be provided in the
Close message after the status code. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
        <p class="note" role="note">The <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.2" id="ref-for-section-7.1.2②">start the WebSocket closing handshake</a> algorithm eventually invokes the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.1" id="ref-for-section-7.1.1②">close the WebSocket connection</a> algorithm, which then establishes that <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.4" id="ref-for-section-7.1.4②">the WebSocket
connection is closed</a>, which fires the <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close③"><code>close</code></a> event <a href="#closeWebSocket">as described below</a>. </p>
       <dt data-md>Otherwise
       <dd data-md>
        <p>Set the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate⑥">readyState</a></code> attribute’s value to <code class="idl"><a data-link-type="idl" href="#dom-websocket-closing" id="ref-for-dom-websocket-closing③">CLOSING</a></code> (2). </p>
        <p class="note" role="note"><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3①">The WebSocket closing handshake
is started</a>, and will eventually invoke the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.1" id="ref-for-section-7.1.1③">close the
WebSocket connection</a> algorithm, which will establish that <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.4" id="ref-for-section-7.1.4③">the WebSocket connection is closed</a>, and thus the <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close④"><code>close</code></a> event will fire, <a href="#closeWebSocket">as described
below</a>. </p>
      </dl>
    </ol>
   </div>
   <p class="note" role="note">The <code class="idl"><a data-link-type="idl" href="#dom-websocket-close" id="ref-for-dom-websocket-close③">close()</a></code> method does not discard previously sent messages before
starting the WebSocket closing handshake — even if, in practice, the user agent is still busy
sending those messages, the handshake will only start after the messages are sent. </p>
   <hr>
   <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-bufferedamount"><code>bufferedAmount</code></dfn> attribute must return the number of bytes of
application data (UTF-8 text and binary data) that have been queued using <code class="idl"><a data-link-type="idl" href="#dom-websocket-send" id="ref-for-dom-websocket-send④">send()</a></code> but
that, as of the last time the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop">event loop</a> reached <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#step1" id="ref-for-step1">step 1</a>, had not yet
been transmitted to the network. (This thus includes any text sent during the execution of the
current task, regardless of whether the user agent is able to transmit text in the background <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel" id="ref-for-in-parallel①">in
parallel</a> with script execution.) This does not include framing overhead incurred by the protocol,
or buffering done by the operating system or network hardware.</p>
   <div class="example" id="buffered-amount-example">
    <a class="self-link" href="#buffered-amount-example"></a> 
    <p>In this simple example, the <code class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount②">bufferedAmount</a></code> attribute is used to ensure that updates
are sent either at the rate of one update every 50ms, if the network can handle that rate, or at
whatever rate the network <em>can</em> handle, if that is too fast.</p>
<pre class="highlight"><c- a>var</c-> socket <c- o>=</c-> <c- k>new</c-> WebSocket<c- p>(</c-><c- t>'ws://game.example.com:12010/updates'</c-><c- p>);</c->
socket<c- p>.</c->onopen <c- o>=</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c->
  setInterval<c- p>(</c-><c- a>function</c-><c- p>()</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->socket<c- p>.</c->bufferedAmount <c- o>==</c-> <c- mi>0</c-><c- p>)</c->
      socket<c- p>.</c->send<c- p>(</c->getUpdateData<c- p>());</c->
  <c- p>},</c-> <c- mi>50</c-><c- p>);</c->
<c- p>};</c->
</pre>
    <p>The <code class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount③">bufferedAmount</a></code> attribute can also be
used to saturate the network without sending the data at a higher rate than the network can
handle, though this requires more careful monitoring of the value of the attribute over time.</p>
   </div>
   <hr>
   <div>
    <p>When a <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑧">WebSocket</a></code> object is created, its <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-binarytype"><code>binaryType</code></dfn> IDL attribute must be set to the string
"<code><a data-link-type="dfn" href="#blob" id="ref-for-blob①">blob</a></code>". On getting, it must return the last value it was set to. On setting, the
user agent must set the IDL attribute to the new value.</p>
    <p class="note" role="note">User agents can use the <code class="idl"><a data-link-type="idl" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype②">binaryType</a></code> attribute as a hint for how to handle
incoming binary data: if the attribute is set to "<code><a data-link-type="dfn" href="#blob" id="ref-for-blob②">blob</a></code>", it is safe to spool it to
disk, and if it is set to "<code><a data-link-type="dfn" href="#arraybuffer" id="ref-for-arraybuffer①">arraybuffer</a></code>", it is likely more efficient to keep the data
in memory. Naturally, user agents are encouraged to use more subtle heuristics to decide whether to
keep incoming data in memory or not, e.g. based on how big the data is or how common it is for a
script to change the attribute at the last minute. This latter aspect is important in particular
because it is quite possible for the attribute to be changed after the user agent has received the
data but before the user agent has fired the event for it. </p>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="method" data-export id="dom-websocket-send"><code>send(<var>data</var>)</code></dfn> method transmits data
using the connection. If the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate⑦">readyState</a></code> attribute is <code>CONNECTING</code>, it must
throw an "<code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code>" <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMException" id="ref-for-idl-DOMException⑦">DOMException</a></code>. Otherwise, the user agent must run the
appropriate set of steps from the following list:</p>
    <dl>
     <dt data-md>If the argument is a string
     <dd data-md>
      <p>If <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established④">the WebSocket connection is established</a> and <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3②">the WebSocket closing handshake has not yet started</a>, then the user agent must <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_" id="ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_">send a
WebSocket Message</a> comprised of the <var>data</var> argument using a text frame opcode; if the data cannot
be sent, e.g. because it would need to be buffered but the buffer is full, the user agent must <a data-link-type="dfn" href="#flagged-as-full" id="ref-for-flagged-as-full">flag the WebSocket as full</a> and then <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.1" id="ref-for-section-7.1.1④">close the WebSocket connection</a>.
Any invocation of this method with a string argument that does not throw an exception must increase
the <code class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount④">bufferedAmount</a></code> attribute by the number of bytes needed to express the argument as
UTF-8. <a data-link-type="biblio" href="#biblio-unicode">[UNICODE]</a> <a data-link-type="biblio" href="#biblio-encoding">[ENCODING]</a> <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
     <dt data-md>If the argument is a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob③">Blob</a></code> object
     <dd data-md>
      <p>If <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established⑤">the WebSocket connection is established</a>, and <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3③">the WebSocket closing handshake has not yet started</a>, then the user agent must <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_" id="ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_①">send a
WebSocket Message</a> comprised of <var>data</var> using a binary frame opcode; if the data cannot be sent,
e.g. because it would need to be buffered but the buffer is full, the user agent must <a data-link-type="dfn" href="#flagged-as-full" id="ref-for-flagged-as-full①">flag the WebSocket as full</a> and then <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.1" id="ref-for-section-7.1.1⑤">close the WebSocket connection</a>.
The data to be sent is the raw data represented by the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob④">Blob</a></code> object. 
Any invocation of this
method with a <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob⑤">Blob</a></code> argument that does not throw an exception must increase the <code class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount⑤">bufferedAmount</a></code> attribute by the size of the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob⑥">Blob</a></code> object’s raw data, in
bytes. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> <a data-link-type="biblio" href="#biblio-fileapi">[FILEAPI]</a> </p>
     <dt data-md>If the argument is an <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer②">ArrayBuffer</a></code> object
     <dd data-md>
      <p>If <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established⑥">the WebSocket connection is established</a>, and <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3④">the WebSocket closing handshake has not yet started</a>, then the user agent must <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_" id="ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_②">send a
WebSocket Message</a> comprised of <var>data</var> using a binary frame opcode; if the data cannot be sent,
e.g. because it would need to be buffered but the buffer is full, the user agent must <a data-link-type="dfn" href="#flagged-as-full" id="ref-for-flagged-as-full②">flag the WebSocket as full</a> and then <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.1" id="ref-for-section-7.1.1⑥">close the WebSocket connection</a>.
The data to be sent is the data stored in the buffer described by the <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer③">ArrayBuffer</a></code> object. Any
invocation of this method with an <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer④">ArrayBuffer</a></code> argument that does not throw an exception must
increase the <code class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount⑥">bufferedAmount</a></code> attribute by the length of the <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer⑤">ArrayBuffer</a></code> in bytes. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
     <dt data-md>If the argument is an object that matches the <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#ArrayBufferView" id="ref-for-ArrayBufferView①">ArrayBufferView</a></code> type definition
     <dd data-md>
      <p>If <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established⑦">the WebSocket connection is established</a>, and <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3⑤">the WebSocket closing handshake has not yet started</a>, then the user agent must <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_" id="ref-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_③">send a
WebSocket Message</a> comprised of <var>data</var> using a binary frame opcode; if the data cannot be sent,
e.g. because it would need to be buffered but the buffer is full, the user agent must <a data-link-type="dfn" href="#flagged-as-full" id="ref-for-flagged-as-full③">flag the WebSocket as full</a> and then <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.1" id="ref-for-section-7.1.1⑦">close the WebSocket connection</a>.
The data to be sent is the data stored in the section of the buffer described by the <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer⑥">ArrayBuffer</a></code> object that <var>data</var> references. Any invocation of this method with this kind of
argument that does not throw an exception must increase the <code class="idl"><a data-link-type="idl" href="#dom-websocket-bufferedamount" id="ref-for-dom-websocket-bufferedamount⑦">bufferedAmount</a></code> attribute
by the length of <var>data</var>’s buffer in bytes. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a> </p>
    </dl>
   </div>
   <hr>
   <p>The following are the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers">event handlers</a> (and their corresponding <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type">event
handler event types</a>) that must be supported, as <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes" id="ref-for-event-handler-idl-attributes">event handler IDL
attributes</a>, by all objects implementing the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket⑨">WebSocket</a></code> interface:</p>
   <table>
    <thead>
     <tr>
      <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers①">Event handler</a> 
      <th><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type①">Event handler event type</a> 
    <tbody>
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-onopen"><code>onopen</code></dfn> 
      <td> <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-open" id="ref-for-event-open"><code>open</code></a> 
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-onmessage"><code>onmessage</code></dfn> 
      <td> <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-message" id="ref-for-event-message"><code>message</code></a> 
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-onerror"><code>onerror</code></dfn> 
      <td> <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-error" id="ref-for-event-error"><code>error</code></a> 
     <tr>
      <td><dfn class="dfn-paneled idl-code" data-dfn-for="WebSocket" data-dfn-type="attribute" data-export id="dom-websocket-onclose"><code>onclose</code></dfn> 
      <td> <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close⑤"><code>close</code></a> 
   </table>
   <div>
    <h2 class="heading settled" data-level="4" id="feedback-from-the-protocol"><span class="secno">4. </span><span class="content">Feedback from the protocol</span><a class="self-link" href="#feedback-from-the-protocol"></a></h2>
    <p>When <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established⑧">the WebSocket connection is established</a>, the
user agent must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">queue a task</a> to run these steps:</p>
    <ol>
     <li data-md>
      <p>Change the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate⑧">readyState</a></code> attribute’s value to <code><a data-link-type="dfn" href="#open" id="ref-for-open">OPEN</a></code> (1).</p>
     <li data-md>
      <p>Change the <code class="idl"><a data-link-type="idl" href="#dom-websocket-extensions" id="ref-for-dom-websocket-extensions②">extensions</a></code> attribute’s value to the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and①">extensions in
  use</a>, if it is not the null value. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
     <li data-md>
      <p>Change the <code class="idl"><a data-link-type="idl" href="#dom-websocket-protocol" id="ref-for-dom-websocket-protocol②">protocol</a></code> attribute’s value to the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-19:~:text=_Subprotocol%20In,Use_" id="ref-for-page-19:~:text=_Subprotocol%20In,Use_">subprotocol in
  use</a>, if it is not the null value. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire">Fire an event</a> named <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-open" id="ref-for-event-open①"><code>open</code></a> at the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⓪">WebSocket</a></code> object.</p>
    </ol>
    <p class="note" role="note">Since the algorithm above is <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">queued as a task</a>, there is no
race condition between <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established⑨">the WebSocket connection
being established</a> and the script setting up an event listener for the <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-open" id="ref-for-event-open②"><code>open</code></a> event. </p>
    <hr>
    <p>When <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_" id="ref-for-page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_">a WebSocket message has been received</a> with type <var>type</var> and data <var>data</var>, the user agent must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task②">queue a task</a> to follow these steps: <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
    <ol>
     <li data-md>
      <p>If the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate⑨">readyState</a></code> attribute’s value is not <code><a data-link-type="dfn" href="#open" id="ref-for-open①">OPEN</a></code> (1), then return.</p>
     <li data-md>
      <p>Let <var>dataForEvent</var> be determined by switching on <var>type</var> and <code class="idl"><a data-link-type="idl" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype③">binaryType</a></code>:</p>
      <dl class="switch">
       <dt data-md><var>type</var> indicates that the data is Text
       <dd data-md>
        <p>a new <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString④">DOMString</a></code> containing <var>data</var></p>
       <dt data-md><var>type</var> indicates that the data is Binary and <code class="idl"><a data-link-type="idl" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype④">binaryType</a></code> is
 "<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="blob"><code>blob</code></dfn>"
       <dd data-md>
        <p>a new <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/FileAPI/#dfn-Blob" id="ref-for-dfn-Blob⑦">Blob</a></code> object, created in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm">relevant Realm</a> of the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①①">WebSocket</a></code> object, that represents <var>data</var> as its raw data <a data-link-type="biblio" href="#biblio-fileapi">[FILEAPI]</a></p>
       <dt data-md><var>type</var> indicates that the data is Binary and <code class="idl"><a data-link-type="idl" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype⑤">binaryType</a></code> is
 "<dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="arraybuffer"><code>arraybuffer</code></dfn>"
       <dd data-md>
        <p>a new <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer⑦">ArrayBuffer</a></code> object, created in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm" id="ref-for-concept-relevant-realm①">relevant Realm</a> of the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①②">WebSocket</a></code> object,
  whose contents are <var>data</var></p>
      </dl>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire①">Fire an event</a> named <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-message" id="ref-for-event-message①"><code>message</code></a> at the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①③">WebSocket</a></code> object,
  using <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#messageevent" id="ref-for-messageevent">MessageEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin" id="ref-for-dom-messageevent-origin">origin</a></code> attribute initialized to the <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-serializer" id="ref-for-concept-url-serializer①">serialization</a> of the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①④">WebSocket</a></code> object’s <a data-link-type="dfn" href="#url" id="ref-for-url③">url</a>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url-origin" id="ref-for-concept-url-origin">origin</a>, and
  the <code class="idl"><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data" id="ref-for-dom-messageevent-data">data</a></code> attribute initialized to <var>dataForEvent</var>.</p>
    </ol>
    <p class="note" role="note">User agents are encouraged to check if they can perform the above steps efficiently
before they run the task, picking tasks from other <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue" id="ref-for-task-queue">task queues</a> while they prepare the buffers if
not. For example, if the <code class="idl"><a data-link-type="idl" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype⑥">binaryType</a></code> attribute was set to "<a data-link-type="dfn" href="#blob" id="ref-for-blob③"><code>blob</code></a>" when the data arrived, and the user agent spooled all the data to disk,
but just before running the above <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task">task</a> for this particular message the script switched <code class="idl"><a data-link-type="idl" href="#dom-websocket-binarytype" id="ref-for-dom-websocket-binarytype⑦">binaryType</a></code> to "<a data-link-type="dfn" href="#arraybuffer" id="ref-for-arraybuffer②"><code>arraybuffer</code></a>", the user agent would want to page
the data back to RAM before running this <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task①">task</a> so as to avoid stalling the main thread while it
created the <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-ArrayBuffer" id="ref-for-idl-ArrayBuffer⑧">ArrayBuffer</a></code> object. </p>
   </div>
   <div class="example" id="message-example">
    <a class="self-link" href="#message-example"></a> 
    <p>Here is an example of how to define a handler for the <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-message" id="ref-for-event-message②"><code>message</code></a> event in the case of text frames:</p>
<pre class="highlight">mysocket<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'on'</c-><c- p>)</c-> <c- p>{</c->
    turnLampOn<c- p>();</c->
  <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'off'</c-><c- p>)</c-> <c- p>{</c->
    turnLampOff<c- p>();</c->
  <c- p>}</c->
<c- p>};</c->
</pre>
    <p>The protocol here is a trivial one, with the server just sending "on" or "off" messages.</p>
   </div>
   <hr>
   <div>
    <p>When <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3⑥">the websocket closing handshake is started</a>, the user agent must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task③">queue a task</a> to change the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate①⓪">readyState</a></code> attribute’s value to <code><a data-link-type="dfn" href="#closing" id="ref-for-closing">CLOSING</a></code> (2). (If the <code class="idl"><a data-link-type="idl" href="#dom-websocket-close" id="ref-for-dom-websocket-close④">close()</a></code> method was called, the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate①①">readyState</a></code> attribute’s value will already be set to <code><a data-link-type="dfn" href="#closing" id="ref-for-closing①">CLOSING</a></code> (2) when this task runs.) <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
    <hr>
    <p id="closeWebSocket">When <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.4" id="ref-for-section-7.1.4④">the WebSocket connection is closed</a>, possibly <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-41:~:text=closed-,_cleanly_." id="ref-for-page-41:~:text=closed-,_cleanly_.">cleanly</a>, the user agent must <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task④">queue a task</a> to run the following substeps: </p>
    <ol>
     <li data-md>
      <p>Change the <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate①②">readyState</a></code> attribute’s value to <code><a data-link-type="dfn" href="#closed" id="ref-for-closed">CLOSED</a></code> (3).</p>
     <li data-md>
      <p>If the user agent was required to <a data-link-type="dfn" href="#fail-the-websocket-connection" id="ref-for-fail-the-websocket-connection⑥">fail the WebSocket connection</a>, or if the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.4" id="ref-for-section-7.1.4⑤">the WebSocket connection was closed</a> after being <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="flagged as full" data-noexport id="flagged-as-full">flagged
  as full</dfn>, <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire②">fire an event</a> named <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-error" id="ref-for-event-error①"><code>error</code></a> at the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑤">WebSocket</a></code> object. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
    </ol>
    <ol>
     <li data-md>
      <p><a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event-fire" id="ref-for-concept-event-fire③">Fire an event</a> named <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close⑥"><code>close</code></a> at the <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑥">WebSocket</a></code> object, using <code class="idl"><a data-link-type="idl" href="#closeevent" id="ref-for-closeevent">CloseEvent</a></code>, with the <code class="idl"><a data-link-type="idl" href="#dom-closeevent-wasclean" id="ref-for-dom-closeevent-wasclean">wasClean</a></code> attribute initialized to true if the connection
  closed <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-41:~:text=closed-,_cleanly_." id="ref-for-page-41:~:text=closed-,_cleanly_.①">cleanly</a> and false otherwise, the <code class="idl"><a data-link-type="idl" href="#dom-closeevent-code" id="ref-for-dom-closeevent-code">code</a></code> attribute initialized to <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.5" id="ref-for-section-7.1.5①">the
  WebSocket connection close code</a>, and the <code class="idl"><a data-link-type="idl" href="#dom-closeevent-reason" id="ref-for-dom-closeevent-reason">reason</a></code> attribute initialized to the
  result of applying <a data-link-type="dfn" href="https://encoding.spec.whatwg.org/#utf-8-decode-without-bom" id="ref-for-utf-8-decode-without-bom">UTF-8 decode without BOM</a> to <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.6" id="ref-for-section-7.1.6①">the WebSocket connection close reason</a>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
    </ol>
    <div class="warning">
     <p>User agents must not convey any failure information to scripts in a way that would allow a
script to distinguish the following situations:</p>
     <ul>
      <li data-md>
       <p>A server whose host name could not be resolved.</p>
      <li data-md>
       <p>A server to which packets could not successfully be routed.</p>
      <li data-md>
       <p>A server that refused the connection on the specified port.</p>
      <li data-md>
       <p>A server that failed to correctly perform a TLS handshake (e.g., the server certificate
 can’t be verified).</p>
      <li data-md>
       <p>A server that did not complete the opening handshake (e.g. because it was not a WebSocket
 server).</p>
      <li data-md>
       <p>A WebSocket server that sent a correct opening handshake, but that specified
 options that caused the client to drop the connection (e.g. the server
 specified a subprotocol that the client did not offer).</p>
      <li data-md>
       <p>A WebSocket server that abruptly closed the connection after successfully completing the
 opening handshake.</p>
     </ul>
     <p>In all of these cases, the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.5" id="ref-for-section-7.1.5②">the WebSocket connection close code</a> would be 1006, as
required by <cite>WebSocket Protocol</cite>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
     <p>Allowing a script to distinguish these cases would allow a script to probe the user’s local
network in preparation for an attack.</p>
     <p class="note" role="note">In particular, this means the code 1015 is not used by the user agent (unless the
server erroneously uses it in its close frame, of course). </p>
    </div>
    <hr>
    <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source" id="ref-for-task-source">task source</a> for all <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task" id="ref-for-concept-task②">tasks</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task⑤">queued</a> in this section is the <dfn data-dfn-type="dfn" data-export id="websocket-task-source">WebSocket task source<a class="self-link" href="#websocket-task-source"></a></dfn>.</p>
   </div>
   <h2 class="heading settled" data-level="5" id="ping-and-pong-frames"><span class="secno">5. </span><span class="content">Ping and Pong frames</span><a class="self-link" href="#ping-and-pong-frames"></a></h2>
   <p><cite>The WebSocket protocol</cite> defines Ping and Pong frames that can be used for
keep-alive, heart-beats, network status probing, latency instrumentation, and so forth. These are
not currently exposed in the API.</p>
   <p>User agents may send ping and unsolicited pong frames as desired, for example in an
attempt to maintain local network NAT mappings, to detect failed connections, or to display
latency metrics to the user. User agents must not use pings or unsolicited pongs to aid the
server; it is assumed that servers will solicit pongs whenever appropriate for the server’s
needs.</p>
   <h2 class="heading settled" data-level="6" id="the-closeevent-interface"><span class="secno">6. </span><span class="content">The <code class="idl"><a data-link-type="idl" href="#closeevent" id="ref-for-closeevent①">CloseEvent</a></code> interface</span><a class="self-link" href="#the-closeevent-interface"></a></h2>
   <p><code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑦">WebSocket</a></code> objects use the <code class="idl"><a data-link-type="idl" href="#closeevent" id="ref-for-closeevent②">CloseEvent</a></code> interface for their <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close⑦"><code>close</code></a> events:</p>
<pre class="idl highlight def">[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed" id="ref-for-Exposed①"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="closeevent"><code><c- g>CloseEvent</c-></code></dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event" id="ref-for-event"><c- n>Event</c-></a> {
  <dfn class="idl-code" data-dfn-for="CloseEvent" data-dfn-type="constructor" data-export data-lt="CloseEvent(type, eventInitDict)|constructor(type, eventInitDict)|CloseEvent(type)|constructor(type)" id="dom-closeevent-closeevent"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-closeevent-closeevent"></a></dfn>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString⑤"><c- b>DOMString</c-></a> <dfn class="idl-code" data-dfn-for="CloseEvent/CloseEvent(type, eventInitDict), CloseEvent/constructor(type, eventInitDict), CloseEvent/CloseEvent(type), CloseEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-closeevent-closeevent-type-eventinitdict-type"><code><c- g>type</c-></code><a class="self-link" href="#dom-closeevent-closeevent-type-eventinitdict-type"></a></dfn>, <c- b>optional</c-> <a class="n" data-link-type="idl-name" href="#dictdef-closeeventinit" id="ref-for-dictdef-closeeventinit"><c- n>CloseEventInit</c-></a> <dfn class="idl-code" data-dfn-for="CloseEvent/CloseEvent(type, eventInitDict), CloseEvent/constructor(type, eventInitDict), CloseEvent/CloseEvent(type), CloseEvent/constructor(type)" data-dfn-type="argument" data-export id="dom-closeevent-closeevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code><a class="self-link" href="#dom-closeevent-closeevent-type-eventinitdict-eventinitdict"></a></dfn> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-closeevent-wasclean" id="ref-for-dom-closeevent-wasclean①"><c- g>wasClean</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short⑥"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned short" href="#dom-closeevent-code" id="ref-for-dom-closeevent-code①"><c- g>code</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString④"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="USVString" href="#dom-closeevent-reason" id="ref-for-dom-closeevent-reason①"><c- g>reason</c-></a>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-closeeventinit"><code><c- g>CloseEventInit</c-></code></dfn> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit" id="ref-for-dictdef-eventinit"><c- n>EventInit</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean" id="ref-for-idl-boolean①"><c- b>boolean</c-></a> <dfn class="idl-code" data-default="false" data-dfn-for="CloseEventInit" data-dfn-type="dict-member" data-export data-type="boolean " id="dom-closeeventinit-wasclean"><code><c- g>wasClean</c-></code><a class="self-link" href="#dom-closeeventinit-wasclean"></a></dfn> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short⑦"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="idl-code" data-default="0" data-dfn-for="CloseEventInit" data-dfn-type="dict-member" data-export data-type="unsigned short " id="dom-closeeventinit-code"><code><c- g>code</c-></code><a class="self-link" href="#dom-closeeventinit-code"></a></dfn> = 0;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString" id="ref-for-idl-USVString⑤"><c- b>USVString</c-></a> <dfn class="idl-code" data-default="&quot;&quot;" data-dfn-for="CloseEventInit" data-dfn-type="dict-member" data-export data-type="USVString " id="dom-closeeventinit-reason"><code><c- g>reason</c-></code><a class="self-link" href="#dom-closeeventinit-reason"></a></dfn> = "";
};
</pre>
   <dl class="domintro">
    <dt data-md><var>event</var> . <code class="idl"><a data-link-type="idl" href="#dom-closeevent-wasclean" id="ref-for-dom-closeevent-wasclean②">wasClean</a></code>
    <dd data-md>
     <p>Returns true if the connection closed cleanly; false otherwise.</p>
    <dt data-md><var>event</var> . <code class="idl"><a data-link-type="idl" href="#dom-closeevent-code" id="ref-for-dom-closeevent-code②">code</a></code>
    <dd data-md>
     <p>Returns the WebSocket connection close code provided by the server.</p>
    <dt data-md><var>event</var> . <code class="idl"><a data-link-type="idl" href="#dom-closeevent-reason" id="ref-for-dom-closeevent-reason②">reason</a></code>
    <dd data-md>
     <p>Returns the WebSocket connection close reason provided by the server.</p>
   </dl>
   <div>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent" data-dfn-type="attribute" data-export id="dom-closeevent-wasclean"><code>wasClean</code></dfn> attribute must return the value it was initialized
 to. It represents whether the connection closed cleanly or not.</p>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent" data-dfn-type="attribute" data-export id="dom-closeevent-code"><code>code</code></dfn> attribute must return the value it was initialized to.
 It represents the WebSocket connection close code provided by the server.</p>
    <p>The <dfn class="dfn-paneled idl-code" data-dfn-for="CloseEvent" data-dfn-type="attribute" data-export id="dom-closeevent-reason"><code>reason</code></dfn> attribute must return the value it was initialized
to. It represents the WebSocket connection close reason provided by the server.</p>
    <h2 class="heading settled" data-level="7" id="garbage-collection"><span class="secno">7. </span><span class="content">Garbage collection</span><a class="self-link" href="#garbage-collection"></a></h2>
    <p>A <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑧">WebSocket</a></code> object whose <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate①③">readyState</a></code> attribute’s value was set to <code><a data-link-type="dfn" href="#connecting" id="ref-for-connecting">CONNECTING</a></code> (0) as of the last time the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop①">event loop</a> reached <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#step1" id="ref-for-step1①">step 1</a> must not be garbage collected if there are any event listeners registered for <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-open" id="ref-for-event-open③"><code>open</code></a> events, <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-message" id="ref-for-event-message③"><code>message</code></a> events, <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-error" id="ref-for-event-error②"><code>error</code></a> events, or <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close⑧"><code>close</code></a> events.</p>
    <p>A <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket①⑨">WebSocket</a></code> object whose <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate①④">readyState</a></code> attribute’s value was set to <code><a data-link-type="dfn" href="#open" id="ref-for-open②">OPEN</a></code> (1) as of the last time the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop②">event loop</a> reached <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#step1" id="ref-for-step1②">step
1</a> must not be garbage collected if there are any event listeners registered for <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-message" id="ref-for-event-message④"><code>message</code></a> events, <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-error" id="ref-for-event-error③"><code>error</code></a>, or <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close⑨"><code>close</code></a> events.</p>
    <p>A <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②⓪">WebSocket</a></code> object whose <code class="idl"><a data-link-type="idl" href="#dom-websocket-readystate" id="ref-for-dom-websocket-readystate①⑤">readyState</a></code> attribute’s value was set to <code><a data-link-type="dfn" href="#closing" id="ref-for-closing②">CLOSING</a></code> (2) as of the last time the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop" id="ref-for-event-loop③">event loop</a> reached <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#step1" id="ref-for-step1③">step 1</a> must not be garbage collected if there are any event listeners
registered for <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-error" id="ref-for-event-error④"><code>error</code></a> or <a class="idl-code" data-link-type="event" href="https://html.spec.whatwg.org/multipage/indices.html#event-close" id="ref-for-event-close①⓪"><code>close</code></a> events.</p>
    <p>A <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②①">WebSocket</a></code> object with <a data-link-type="dfn" href="#the-websocket-connection-is-established" id="ref-for-the-websocket-connection-is-established①⓪">an established
connection</a> that has data queued to be transmitted to the network must not be garbage collected. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
    <p>If a <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②②">WebSocket</a></code> object is garbage collected while its connection is still open, the user agent
must <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.2" id="ref-for-section-7.1.2③">start the WebSocket closing handshake</a>, with no status code for the Close
message. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
    <hr>
    <p>If a user agent is to <dfn data-dfn-type="dfn" data-export id="make-disappear">make disappear<a class="self-link" href="#make-disappear"></a></dfn> a <code class="idl"><a data-link-type="idl" href="#websocket" id="ref-for-websocket②③">WebSocket</a></code> object (this happens
when a <code class="idl"><a data-link-type="idl" href="https://dom.spec.whatwg.org/#document" id="ref-for-document">Document</a></code> object goes away), the user agent must follow the first appropriate
set of steps from the following list:</p>
    <dl class="switch">
     <dt data-md>If the WebSocket connection is not yet <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" id="ref-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and②">established</a> <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a>
     <dd data-md>
      <p><a data-link-type="dfn" href="#fail-the-websocket-connection" id="ref-for-fail-the-websocket-connection⑦">Fail the WebSocket connection</a>. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
     <dt data-md>If the WebSocket closing handshake has not yet been <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.3" id="ref-for-section-7.1.3⑦">started</a> <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a>
     <dd data-md>
      <p><a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6455#section-7.1.2" id="ref-for-section-7.1.2④">Start the WebSocket closing handshake</a>, with the status code to use in the
  WebSocket Close message being 1001. <a data-link-type="biblio" href="#biblio-wsp">[WSP]</a></p>
     <dt data-md>Otherwise
     <dd data-md>
      <p>Do nothing.</p>
    </dl>
   </div>
   <p>Copyright © 2021 WHATWG (Apple, Google, Mozilla, Microsoft). This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution
4.0 International License</a>. </p>
  </main>
<script>
"use strict";
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js");
}
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-binarytype-arraybuffer">"arraybuffer"</a><span>, in §3.1</span>
   <li><a href="#arraybuffer">arraybuffer</a><span>, in §4</span>
   <li><a href="#enumdef-binarytype">BinaryType</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-binarytype">binaryType</a><span>, in §3.1</span>
   <li><a href="#dom-binarytype-blob">"blob"</a><span>, in §3.1</span>
   <li><a href="#blob">blob</a><span>, in §4</span>
   <li><a href="#dom-websocket-bufferedamount">bufferedAmount</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-close">close()</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-close">close(code)</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-close">close(code, reason)</a><span>, in §3.1</span>
   <li>
    CLOSED
    <ul>
     <li><a href="#dom-websocket-closed">const for WebSocket</a><span>, in §3.1</span>
     <li><a href="#closed">definition of</a><span>, in §3.1</span>
    </ul>
   <li><a href="#closeevent">CloseEvent</a><span>, in §6</span>
   <li><a href="#dictdef-closeeventinit">CloseEventInit</a><span>, in §6</span>
   <li><a href="#dom-closeevent-closeevent">CloseEvent(type)</a><span>, in §6</span>
   <li><a href="#dom-closeevent-closeevent">CloseEvent(type, eventInitDict)</a><span>, in §6</span>
   <li>
    CLOSING
    <ul>
     <li><a href="#dom-websocket-closing">const for WebSocket</a><span>, in §3.1</span>
     <li><a href="#closing">definition of</a><span>, in §3.1</span>
    </ul>
   <li>
    code
    <ul>
     <li><a href="#dom-closeevent-code">attribute for CloseEvent</a><span>, in §6</span>
     <li><a href="#dom-closeeventinit-code">dict-member for CloseEventInit</a><span>, in §6</span>
    </ul>
   <li>
    CONNECTING
    <ul>
     <li><a href="#dom-websocket-connecting">const for WebSocket</a><span>, in §3.1</span>
     <li><a href="#connecting">definition of</a><span>, in §3.1</span>
    </ul>
   <li><a href="#dom-closeevent-closeevent">constructor(type)</a><span>, in §6</span>
   <li><a href="#dom-closeevent-closeevent">constructor(type, eventInitDict)</a><span>, in §6</span>
   <li><a href="#dom-websocket-websocket">constructor(url)</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-websocket">constructor(url, protocols)</a><span>, in §3.1</span>
   <li><a href="#concept-websocket-establish">establish a WebSocket connection</a><span>, in §2.2</span>
   <li><a href="#dom-websocket-extensions">extensions</a><span>, in §3.1</span>
   <li><a href="#fail-the-websocket-connection">Fail the WebSocket connection</a><span>, in §2.2</span>
   <li><a href="#flagged-as-full">flagged as full</a><span>, in §3.1</span>
   <li><a href="#make-disappear">make disappear</a><span>, in §7</span>
   <li><a href="#concept-websocket-connection-obtain">obtain a WebSocket connection</a><span>, in §2.1</span>
   <li><a href="#dom-websocket-onclose">onclose</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-onerror">onerror</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-onmessage">onmessage</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-onopen">onopen</a><span>, in §3.1</span>
   <li>
    OPEN
    <ul>
     <li><a href="#dom-websocket-open">const for WebSocket</a><span>, in §3.1</span>
     <li><a href="#open">definition of</a><span>, in §3.1</span>
    </ul>
   <li><a href="#dom-websocket-protocol">protocol</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-readystate">readyState</a><span>, in §3.1</span>
   <li>
    reason
    <ul>
     <li><a href="#dom-closeevent-reason">attribute for CloseEvent</a><span>, in §6</span>
     <li><a href="#dom-closeeventinit-reason">dict-member for CloseEventInit</a><span>, in §6</span>
    </ul>
   <li><a href="#dom-websocket-send">send(data)</a><span>, in §3.1</span>
   <li><a href="#the-websocket-connection-is-established">the WebSocket connection is established</a><span>, in §2.2</span>
   <li>
    url
    <ul>
     <li><a href="#dom-websocket-url">attribute for WebSocket</a><span>, in §3.1</span>
     <li><a href="#url">definition of</a><span>, in §3.1</span>
    </ul>
   <li>
    wasClean
    <ul>
     <li><a href="#dom-closeevent-wasclean">attribute for CloseEvent</a><span>, in §6</span>
     <li><a href="#dom-closeeventinit-wasclean">dict-member for CloseEventInit</a><span>, in §6</span>
    </ul>
   <li><a href="#websocket">WebSocket</a><span>, in §3.1</span>
   <li><a href="#websocket-task-source">WebSocket task source</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-websocket">WebSocket(url)</a><span>, in §3.1</span>
   <li><a href="#dom-websocket-websocket">WebSocket(url, protocols)</a><span>, in §3.1</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-document">
   <a href="https://dom.spec.whatwg.org/#document">https://dom.spec.whatwg.org/#document</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event">
   <a href="https://dom.spec.whatwg.org/#event">https://dom.spec.whatwg.org/#event</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event">6. The CloseEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dictdef-eventinit">
   <a href="https://dom.spec.whatwg.org/#dictdef-eventinit">https://dom.spec.whatwg.org/#dictdef-eventinit</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-eventinit">6. The CloseEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventtarget">
   <a href="https://dom.spec.whatwg.org/#eventtarget">https://dom.spec.whatwg.org/#eventtarget</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventtarget">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-event-fire">
   <a href="https://dom.spec.whatwg.org/#concept-event-fire">https://dom.spec.whatwg.org/#concept-event-fire</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-event-fire">4. Feedback from the protocol</a> <a href="#ref-for-concept-event-fire①">(2)</a>
    <li><a href="#ref-for-concept-event-fire②">3.1. Interface definition</a> <a href="#ref-for-concept-event-fire③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-utf-8-decode-without-bom">
   <a href="https://encoding.spec.whatwg.org/#utf-8-decode-without-bom">https://encoding.spec.whatwg.org/#utf-8-decode-without-bom</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-utf-8-decode-without-bom">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-utf-8-encode">
   <a href="https://encoding.spec.whatwg.org/#utf-8-encode">https://encoding.spec.whatwg.org/#utf-8-encode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-utf-8-encode">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-list-append">
   <a href="https://fetch.spec.whatwg.org/#concept-header-list-append">https://fetch.spec.whatwg.org/#concept-header-list-append</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-list-append">2.2. Opening handshake</a> <a href="#ref-for-concept-header-list-append①">(2)</a> <a href="#ref-for-concept-header-list-append②">(3)</a> <a href="#ref-for-concept-header-list-append③">(4)</a> <a href="#ref-for-concept-header-list-append④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-cache-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-cache-mode">https://fetch.spec.whatwg.org/#concept-request-cache-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-cache-mode">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-client">
   <a href="https://fetch.spec.whatwg.org/#concept-request-client">https://fetch.spec.whatwg.org/#concept-request-client</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-client">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-list-combine">
   <a href="https://fetch.spec.whatwg.org/#concept-header-list-combine">https://fetch.spec.whatwg.org/#concept-header-list-combine</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-list-combine">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-connection">
   <a href="https://fetch.spec.whatwg.org/#concept-connection">https://fetch.spec.whatwg.org/#concept-connection</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-connection">2.1. Connections</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-credentials-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-credentials-mode">https://fetch.spec.whatwg.org/#concept-request-credentials-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-credentials-mode">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-extract-header-list-values">
   <a href="https://fetch.spec.whatwg.org/#extract-header-list-values">https://fetch.spec.whatwg.org/#extract-header-list-values</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-extract-header-list-values">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-fetch">
   <a href="https://fetch.spec.whatwg.org/#concept-fetch">https://fetch.spec.whatwg.org/#concept-fetch</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-fetch">2.2. Opening handshake</a> <a href="#ref-for-concept-fetch①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header">
   <a href="https://fetch.spec.whatwg.org/#concept-header">https://fetch.spec.whatwg.org/#concept-header</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-header-list">
   <a href="https://fetch.spec.whatwg.org/#concept-request-header-list">https://fetch.spec.whatwg.org/#concept-request-header-list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-header-list">2.2. Opening handshake</a> <a href="#ref-for-concept-request-header-list①">(2)</a> <a href="#ref-for-concept-request-header-list②">(3)</a> <a href="#ref-for-concept-request-header-list③">(4)</a> <a href="#ref-for-concept-request-header-list④">(5)</a> <a href="#ref-for-concept-request-header-list⑤">(6)</a> <a href="#ref-for-concept-request-header-list⑥">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-mode">https://fetch.spec.whatwg.org/#concept-request-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-mode">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-network-error">
   <a href="https://fetch.spec.whatwg.org/#concept-network-error">https://fetch.spec.whatwg.org/#concept-network-error</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-network-error">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-process-response">
   <a href="https://fetch.spec.whatwg.org/#process-response">https://fetch.spec.whatwg.org/#process-response</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-process-response">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-redirect-mode">
   <a href="https://fetch.spec.whatwg.org/#concept-request-redirect-mode">https://fetch.spec.whatwg.org/#concept-request-redirect-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-redirect-mode">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-referrer">
   <a href="https://fetch.spec.whatwg.org/#concept-request-referrer">https://fetch.spec.whatwg.org/#concept-request-referrer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-referrer">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request">
   <a href="https://fetch.spec.whatwg.org/#concept-request">https://fetch.spec.whatwg.org/#concept-request</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-request-service-workers-mode">
   <a href="https://fetch.spec.whatwg.org/#request-service-workers-mode">https://fetch.spec.whatwg.org/#request-service-workers-mode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-request-service-workers-mode">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-response-status">
   <a href="https://fetch.spec.whatwg.org/#concept-response-status">https://fetch.spec.whatwg.org/#concept-response-status</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-response-status">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-request-url">
   <a href="https://fetch.spec.whatwg.org/#concept-request-url">https://fetch.spec.whatwg.org/#concept-request-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-request-url">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-fetch-useparallelqueue">
   <a href="https://fetch.spec.whatwg.org/#fetch-useparallelqueue">https://fetch.spec.whatwg.org/#fetch-useparallelqueue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fetch-useparallelqueue">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-header-value">
   <a href="https://fetch.spec.whatwg.org/#concept-header-value">https://fetch.spec.whatwg.org/#concept-header-value</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-header-value">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dfn-Blob">
   <a href="https://w3c.github.io/FileAPI/#dfn-Blob">https://w3c.github.io/FileAPI/#dfn-Blob</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dfn-Blob">3.1. Interface definition</a> <a href="#ref-for-dfn-Blob①">(2)</a> <a href="#ref-for-dfn-Blob②">(3)</a> <a href="#ref-for-dfn-Blob③">(4)</a> <a href="#ref-for-dfn-Blob④">(5)</a> <a href="#ref-for-dfn-Blob⑤">(6)</a> <a href="#ref-for-dfn-Blob⑥">(7)</a>
    <li><a href="#ref-for-dfn-Blob⑦">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-eventhandler">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler">https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-eventhandler">3.1. Interface definition</a> <a href="#ref-for-eventhandler①">(2)</a> <a href="#ref-for-eventhandler②">(3)</a> <a href="#ref-for-eventhandler③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-messageevent">
   <a href="https://html.spec.whatwg.org/multipage/comms.html#messageevent">https://html.spec.whatwg.org/multipage/comms.html#messageevent</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-messageevent">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-close">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-close">https://html.spec.whatwg.org/multipage/indices.html#event-close</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-close">3.1. Interface definition</a> <a href="#ref-for-event-close①">(2)</a> <a href="#ref-for-event-close②">(3)</a> <a href="#ref-for-event-close③">(4)</a> <a href="#ref-for-event-close④">(5)</a> <a href="#ref-for-event-close⑤">(6)</a> <a href="#ref-for-event-close⑥">(7)</a>
    <li><a href="#ref-for-event-close⑦">6. The CloseEvent interface</a>
    <li><a href="#ref-for-event-close⑧">7. Garbage collection</a> <a href="#ref-for-event-close⑨">(2)</a> <a href="#ref-for-event-close①⓪">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-messageevent-data">
   <a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data">https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-data</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-messageevent-data">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-entry-settings-object">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object">https://html.spec.whatwg.org/multipage/webappapis.html#entry-settings-object</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-entry-settings-object">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-error">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-error">https://html.spec.whatwg.org/multipage/indices.html#event-error</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-error">3.1. Interface definition</a> <a href="#ref-for-event-error①">(2)</a>
    <li><a href="#ref-for-event-error②">7. Garbage collection</a> <a href="#ref-for-event-error③">(2)</a> <a href="#ref-for-event-error④">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handlers">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers">https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handlers">3.1. Interface definition</a> <a href="#ref-for-event-handlers①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-event-type">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-event-type">3.1. Interface definition</a> <a href="#ref-for-event-handler-event-type①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-handler-idl-attributes">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes">https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-idl-attributes</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-handler-idl-attributes">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-loop">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loop">https://html.spec.whatwg.org/multipage/webappapis.html#event-loop</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-loop">3.1. Interface definition</a>
    <li><a href="#ref-for-event-loop①">7. Garbage collection</a> <a href="#ref-for-event-loop②">(2)</a> <a href="#ref-for-event-loop③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-in-parallel">
   <a href="https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel">https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-in-parallel">3.1. Interface definition</a> <a href="#ref-for-in-parallel①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-message">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-message">https://html.spec.whatwg.org/multipage/indices.html#event-message</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-message">3.1. Interface definition</a> <a href="#ref-for-event-message②">(2)</a>
    <li><a href="#ref-for-event-message①">4. Feedback from the protocol</a>
    <li><a href="#ref-for-event-message③">7. Garbage collection</a> <a href="#ref-for-event-message④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-event-open">
   <a href="https://html.spec.whatwg.org/multipage/indices.html#event-open">https://html.spec.whatwg.org/multipage/indices.html#event-open</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-event-open">3.1. Interface definition</a>
    <li><a href="#ref-for-event-open①">4. Feedback from the protocol</a> <a href="#ref-for-event-open②">(2)</a>
    <li><a href="#ref-for-event-open③">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-messageevent-origin">
   <a href="https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin">https://html.spec.whatwg.org/multipage/comms.html#dom-messageevent-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-messageevent-origin">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queue-a-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-task">4. Feedback from the protocol</a> <a href="#ref-for-queue-a-task①">(2)</a> <a href="#ref-for-queue-a-task②">(3)</a>
    <li><a href="#ref-for-queue-a-task③">3.1. Interface definition</a> <a href="#ref-for-queue-a-task④">(2)</a> <a href="#ref-for-queue-a-task⑤">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-relevant-realm">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm">https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-relevant-realm">4. Feedback from the protocol</a> <a href="#ref-for-concept-relevant-realm①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-step1">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#step1">https://html.spec.whatwg.org/multipage/webappapis.html#step1</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-step1">3.1. Interface definition</a>
    <li><a href="#ref-for-step1①">7. Garbage collection</a> <a href="#ref-for-step1②">(2)</a> <a href="#ref-for-step1③">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#concept-task">https://html.spec.whatwg.org/multipage/webappapis.html#concept-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-task">4. Feedback from the protocol</a> <a href="#ref-for-concept-task①">(2)</a>
    <li><a href="#ref-for-concept-task②">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-task-queue">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-queue">https://html.spec.whatwg.org/multipage/webappapis.html#task-queue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-task-queue">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-task-source">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#task-source">https://html.spec.whatwg.org/multipage/webappapis.html#task-source</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-task-source">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-forgiving-base64-encode">
   <a href="https://infra.spec.whatwg.org/#forgiving-base64-encode">https://infra.spec.whatwg.org/#forgiving-base64-encode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-forgiving-base64-encode">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-isomorphic-encode">
   <a href="https://infra.spec.whatwg.org/#isomorphic-encode">https://infra.spec.whatwg.org/#isomorphic-encode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-isomorphic-encode">2.2. Opening handshake</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-fragment">
   <a href="https://url.spec.whatwg.org/#concept-url-fragment">https://url.spec.whatwg.org/#concept-url-fragment</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-fragment">3.1. Interface definition</a> <a href="#ref-for-concept-url-fragment①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-host">
   <a href="https://url.spec.whatwg.org/#concept-url-host">https://url.spec.whatwg.org/#concept-url-host</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-host">2.1. Connections</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-origin">
   <a href="https://url.spec.whatwg.org/#concept-url-origin">https://url.spec.whatwg.org/#concept-url-origin</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-origin">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-port">
   <a href="https://url.spec.whatwg.org/#concept-url-port">https://url.spec.whatwg.org/#concept-url-port</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-port">2.1. Connections</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-scheme">
   <a href="https://url.spec.whatwg.org/#concept-url-scheme">https://url.spec.whatwg.org/#concept-url-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-scheme">2.1. Connections</a>
    <li><a href="#ref-for-concept-url-scheme①">2.2. Opening handshake</a> <a href="#ref-for-concept-url-scheme②">(2)</a>
    <li><a href="#ref-for-concept-url-scheme③">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">3.1. Interface definition</a> <a href="#ref-for-concept-url①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-parser">
   <a href="https://url.spec.whatwg.org/#concept-url-parser">https://url.spec.whatwg.org/#concept-url-parser</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-parser">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url">
   <a href="https://url.spec.whatwg.org/#concept-url">https://url.spec.whatwg.org/#concept-url</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url">3.1. Interface definition</a> <a href="#ref-for-concept-url①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-url-serializer">
   <a href="https://url.spec.whatwg.org/#concept-url-serializer">https://url.spec.whatwg.org/#concept-url-serializer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-url-serializer">3.1. Interface definition</a>
    <li><a href="#ref-for-concept-url-serializer①">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-ArrayBuffer">
   <a href="https://heycam.github.io/webidl/#idl-ArrayBuffer">https://heycam.github.io/webidl/#idl-ArrayBuffer</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-ArrayBuffer">3.1. Interface definition</a> <a href="#ref-for-idl-ArrayBuffer①">(2)</a> <a href="#ref-for-idl-ArrayBuffer②">(3)</a> <a href="#ref-for-idl-ArrayBuffer③">(4)</a> <a href="#ref-for-idl-ArrayBuffer④">(5)</a> <a href="#ref-for-idl-ArrayBuffer⑤">(6)</a> <a href="#ref-for-idl-ArrayBuffer⑥">(7)</a>
    <li><a href="#ref-for-idl-ArrayBuffer⑦">4. Feedback from the protocol</a> <a href="#ref-for-idl-ArrayBuffer⑧">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ArrayBufferView">
   <a href="https://heycam.github.io/webidl/#ArrayBufferView">https://heycam.github.io/webidl/#ArrayBufferView</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ArrayBufferView">3.1. Interface definition</a> <a href="#ref-for-ArrayBufferView①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-BufferSource">
   <a href="https://heycam.github.io/webidl/#BufferSource">https://heycam.github.io/webidl/#BufferSource</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-BufferSource">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Clamp">
   <a href="https://heycam.github.io/webidl/#Clamp">https://heycam.github.io/webidl/#Clamp</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Clamp">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMException">
   <a href="https://heycam.github.io/webidl/#idl-DOMException">https://heycam.github.io/webidl/#idl-DOMException</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMException">3.1. Interface definition</a> <a href="#ref-for-idl-DOMException①">(2)</a> <a href="#ref-for-idl-DOMException②">(3)</a> <a href="#ref-for-idl-DOMException③">(4)</a> <a href="#ref-for-idl-DOMException④">(5)</a> <a href="#ref-for-idl-DOMException⑤">(6)</a> <a href="#ref-for-idl-DOMException⑥">(7)</a> <a href="#ref-for-idl-DOMException⑦">(8)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">3.1. Interface definition</a> <a href="#ref-for-idl-DOMString①">(2)</a> <a href="#ref-for-idl-DOMString②">(3)</a> <a href="#ref-for-idl-DOMString③">(4)</a>
    <li><a href="#ref-for-idl-DOMString④">4. Feedback from the protocol</a>
    <li><a href="#ref-for-idl-DOMString⑤">6. The CloseEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-Exposed">
   <a href="https://heycam.github.io/webidl/#Exposed">https://heycam.github.io/webidl/#Exposed</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-Exposed">3.1. Interface definition</a>
    <li><a href="#ref-for-Exposed①">6. The CloseEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invalidaccesserror">
   <a href="https://heycam.github.io/webidl/#invalidaccesserror">https://heycam.github.io/webidl/#invalidaccesserror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalidaccesserror">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-invalidstateerror">
   <a href="https://heycam.github.io/webidl/#invalidstateerror">https://heycam.github.io/webidl/#invalidstateerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-invalidstateerror">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-syntaxerror">
   <a href="https://heycam.github.io/webidl/#syntaxerror">https://heycam.github.io/webidl/#syntaxerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-syntaxerror">3.1. Interface definition</a> <a href="#ref-for-syntaxerror①">(2)</a> <a href="#ref-for-syntaxerror②">(3)</a> <a href="#ref-for-syntaxerror③">(4)</a> <a href="#ref-for-syntaxerror④">(5)</a> <a href="#ref-for-syntaxerror⑤">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-USVString">
   <a href="https://heycam.github.io/webidl/#idl-USVString">https://heycam.github.io/webidl/#idl-USVString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-USVString">3.1. Interface definition</a> <a href="#ref-for-idl-USVString①">(2)</a> <a href="#ref-for-idl-USVString②">(3)</a> <a href="#ref-for-idl-USVString③">(4)</a>
    <li><a href="#ref-for-idl-USVString④">6. The CloseEvent interface</a> <a href="#ref-for-idl-USVString⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-boolean">
   <a href="https://heycam.github.io/webidl/#idl-boolean">https://heycam.github.io/webidl/#idl-boolean</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-boolean">6. The CloseEvent interface</a> <a href="#ref-for-idl-boolean①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-undefined">
   <a href="https://heycam.github.io/webidl/#idl-undefined">https://heycam.github.io/webidl/#idl-undefined</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-undefined">3.1. Interface definition</a> <a href="#ref-for-idl-undefined①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-long-long">
   <a href="https://heycam.github.io/webidl/#idl-unsigned-long-long">https://heycam.github.io/webidl/#idl-unsigned-long-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-long-long">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-short">
   <a href="https://heycam.github.io/webidl/#idl-unsigned-short">https://heycam.github.io/webidl/#idl-unsigned-short</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-short">3.1. Interface definition</a> <a href="#ref-for-idl-unsigned-short①">(2)</a> <a href="#ref-for-idl-unsigned-short②">(3)</a> <a href="#ref-for-idl-unsigned-short③">(4)</a> <a href="#ref-for-idl-unsigned-short④">(5)</a> <a href="#ref-for-idl-unsigned-short⑤">(6)</a>
    <li><a href="#ref-for-idl-unsigned-short⑥">6. The CloseEvent interface</a> <a href="#ref-for-idl-unsigned-short⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_">
   <a href="https://tools.ietf.org/html/rfc6455#page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_">https://tools.ietf.org/html/rfc6455#page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-page-66:~:text=_A%2520WebSocket%2520Message%2520Has%2520Been%2520Received_">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-page-41:~:text=closed-,_cleanly_.">
   <a href="https://tools.ietf.org/html/rfc6455#page-41:~:text=closed-,_cleanly_.">https://tools.ietf.org/html/rfc6455#page-41:~:text=closed-,_cleanly_.</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-page-41:~:text=closed-,_cleanly_.">3.1. Interface definition</a> <a href="#ref-for-page-41:~:text=closed-,_cleanly_.①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-7.1.1">
   <a href="https://tools.ietf.org/html/rfc6455#section-7.1.1">https://tools.ietf.org/html/rfc6455#section-7.1.1</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-7.1.1">3.1. Interface definition</a> <a href="#ref-for-section-7.1.1①">(2)</a> <a href="#ref-for-section-7.1.1②">(3)</a> <a href="#ref-for-section-7.1.1③">(4)</a> <a href="#ref-for-section-7.1.1④">(5)</a> <a href="#ref-for-section-7.1.1⑤">(6)</a> <a href="#ref-for-section-7.1.1⑥">(7)</a> <a href="#ref-for-section-7.1.1⑦">(8)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and">
   <a href="https://tools.ietf.org/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and">https://tools.ietf.org/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-page-19:~:text=_The%2520WebSocket%2520Connection%2520is%2520Established_,-and">3.1. Interface definition</a>
    <li><a href="#ref-for-page-19:~:text=_The%2520WebSocket%2520Connection%2520is%2520Established_,-and①">4. Feedback from the protocol</a>
    <li><a href="#ref-for-page-19:~:text=_The%2520WebSocket%2520Connection%2520is%2520Established_,-and②">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and">
   <a href="https://tools.ietf.org/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and">https://tools.ietf.org/html/rfc6455#page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-page-19:~:text=_The%2520WebSocket%2520Connection%2520is%2520Established_,-and">3.1. Interface definition</a>
    <li><a href="#ref-for-page-19:~:text=_The%2520WebSocket%2520Connection%2520is%2520Established_,-and①">4. Feedback from the protocol</a>
    <li><a href="#ref-for-page-19:~:text=_The%2520WebSocket%2520Connection%2520is%2520Established_,-and②">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-11.3.4">
   <a href="https://tools.ietf.org/html/rfc6455#section-11.3.4">https://tools.ietf.org/html/rfc6455#section-11.3.4</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-11.3.4">3.1. Interface definition</a> <a href="#ref-for-section-11.3.4①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_">
   <a href="https://tools.ietf.org/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_">https://tools.ietf.org/html/rfc6455#page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-page-66:~:text=needs%2520to-,_Send%2520a%2520WebSocket%2520Message_">3.1. Interface definition</a> <a href="#ref-for-page-66:~:text=needs%2520to-,_Send%2520a%2520WebSocket%2520Message_①">(2)</a> <a href="#ref-for-page-66:~:text=needs%2520to-,_Send%2520a%2520WebSocket%2520Message_②">(3)</a> <a href="#ref-for-page-66:~:text=needs%2520to-,_Send%2520a%2520WebSocket%2520Message_③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-7.1.2">
   <a href="https://tools.ietf.org/html/rfc6455#section-7.1.2">https://tools.ietf.org/html/rfc6455#section-7.1.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-7.1.2">3.1. Interface definition</a> <a href="#ref-for-section-7.1.2①">(2)</a> <a href="#ref-for-section-7.1.2②">(3)</a>
    <li><a href="#ref-for-section-7.1.2③">7. Garbage collection</a> <a href="#ref-for-section-7.1.2④">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-page-19:~:text=_Subprotocol%20In,Use_">
   <a href="https://tools.ietf.org/html/rfc6455#page-19:~:text=_Subprotocol%20In,Use_">https://tools.ietf.org/html/rfc6455#page-19:~:text=_Subprotocol%20In,Use_</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-page-19:~:text=_Subprotocol%2520In,Use_">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-7.1.3">
   <a href="https://tools.ietf.org/html/rfc6455#section-7.1.3">https://tools.ietf.org/html/rfc6455#section-7.1.3</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-7.1.3">3.1. Interface definition</a> <a href="#ref-for-section-7.1.3①">(2)</a> <a href="#ref-for-section-7.1.3②">(3)</a> <a href="#ref-for-section-7.1.3③">(4)</a> <a href="#ref-for-section-7.1.3④">(5)</a> <a href="#ref-for-section-7.1.3⑤">(6)</a> <a href="#ref-for-section-7.1.3⑥">(7)</a>
    <li><a href="#ref-for-section-7.1.3⑦">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-7.1.5">
   <a href="https://tools.ietf.org/html/rfc6455#section-7.1.5">https://tools.ietf.org/html/rfc6455#section-7.1.5</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-7.1.5">3.1. Interface definition</a> <a href="#ref-for-section-7.1.5①">(2)</a> <a href="#ref-for-section-7.1.5②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-7.1.6">
   <a href="https://tools.ietf.org/html/rfc6455#section-7.1.6">https://tools.ietf.org/html/rfc6455#section-7.1.6</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-7.1.6">3.1. Interface definition</a> <a href="#ref-for-section-7.1.6①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-7.1.4">
   <a href="https://tools.ietf.org/html/rfc6455#section-7.1.4">https://tools.ietf.org/html/rfc6455#section-7.1.4</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-7.1.4">3.1. Interface definition</a> <a href="#ref-for-section-7.1.4①">(2)</a> <a href="#ref-for-section-7.1.4②">(3)</a> <a href="#ref-for-section-7.1.4③">(4)</a> <a href="#ref-for-section-7.1.4④">(5)</a> <a href="#ref-for-section-7.1.4⑤">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-11.1.1">
   <a href="https://tools.ietf.org/html/rfc6455#section-11.1.1">https://tools.ietf.org/html/rfc6455#section-11.1.1</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-11.1.1">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-section-11.1.2">
   <a href="https://tools.ietf.org/html/rfc6455#section-11.1.2">https://tools.ietf.org/html/rfc6455#section-11.1.2</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-section-11.1.2">3.1. Interface definition</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-document" style="color:initial">Document</span>
     <li><span class="dfn-paneled" id="term-for-event" style="color:initial">Event</span>
     <li><span class="dfn-paneled" id="term-for-dictdef-eventinit" style="color:initial">EventInit</span>
     <li><span class="dfn-paneled" id="term-for-eventtarget" style="color:initial">EventTarget</span>
     <li><span class="dfn-paneled" id="term-for-concept-event-fire" style="color:initial">fire an event</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ENCODING]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-utf-8-decode-without-bom" style="color:initial">utf-8 decode without bom</span>
     <li><span class="dfn-paneled" id="term-for-utf-8-encode" style="color:initial">utf-8 encode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-header-list-append" style="color:initial">append</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-cache-mode" style="color:initial">cache mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-client" style="color:initial">client</span>
     <li><span class="dfn-paneled" id="term-for-concept-header-list-combine" style="color:initial">combine</span>
     <li><span class="dfn-paneled" id="term-for-concept-connection" style="color:initial">connection</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-credentials-mode" style="color:initial">credentials mode</span>
     <li><span class="dfn-paneled" id="term-for-extract-header-list-values" style="color:initial">extracting header list values</span>
     <li><span class="dfn-paneled" id="term-for-concept-fetch" style="color:initial">fetch</span>
     <li><span class="dfn-paneled" id="term-for-concept-header" style="color:initial">header</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-header-list" style="color:initial">header list</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-mode" style="color:initial">mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-network-error" style="color:initial">network error</span>
     <li><span class="dfn-paneled" id="term-for-process-response" style="color:initial">processresponse</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-redirect-mode" style="color:initial">redirect mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-referrer" style="color:initial">referrer</span>
     <li><span class="dfn-paneled" id="term-for-concept-request" style="color:initial">request</span>
     <li><span class="dfn-paneled" id="term-for-request-service-workers-mode" style="color:initial">service-workers mode</span>
     <li><span class="dfn-paneled" id="term-for-concept-response-status" style="color:initial">status</span>
     <li><span class="dfn-paneled" id="term-for-concept-request-url" style="color:initial">url</span>
     <li><span class="dfn-paneled" id="term-for-fetch-useparallelqueue" style="color:initial">useparallelqueue</span>
     <li><span class="dfn-paneled" id="term-for-concept-header-value" style="color:initial">value</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FILEAPI]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dfn-Blob" style="color:initial">Blob</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-eventhandler" style="color:initial">EventHandler</span>
     <li><span class="dfn-paneled" id="term-for-messageevent" style="color:initial">MessageEvent</span>
     <li><span class="dfn-paneled" id="term-for-event-close" style="color:initial">close</span>
     <li><span class="dfn-paneled" id="term-for-dom-messageevent-data" style="color:initial">data</span>
     <li><span class="dfn-paneled" id="term-for-entry-settings-object" style="color:initial">entry settings object</span>
     <li><span class="dfn-paneled" id="term-for-event-error" style="color:initial">error</span>
     <li><span class="dfn-paneled" id="term-for-event-handlers" style="color:initial">event handler</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-event-type" style="color:initial">event handler event type</span>
     <li><span class="dfn-paneled" id="term-for-event-handler-idl-attributes" style="color:initial">event handler idl attribute</span>
     <li><span class="dfn-paneled" id="term-for-event-loop" style="color:initial">event loop</span>
     <li><span class="dfn-paneled" id="term-for-in-parallel" style="color:initial">in parallel</span>
     <li><span class="dfn-paneled" id="term-for-event-message" style="color:initial">message</span>
     <li><span class="dfn-paneled" id="term-for-event-open" style="color:initial">open</span>
     <li><span class="dfn-paneled" id="term-for-dom-messageevent-origin" style="color:initial">origin</span>
     <li><span class="dfn-paneled" id="term-for-queue-a-task" style="color:initial">queue a task</span>
     <li><span class="dfn-paneled" id="term-for-concept-relevant-realm" style="color:initial">relevant realm</span>
     <li><span class="dfn-paneled" id="term-for-step1" style="color:initial">step 1</span>
     <li><span class="dfn-paneled" id="term-for-concept-task" style="color:initial">task</span>
     <li><span class="dfn-paneled" id="term-for-task-queue" style="color:initial">task queues</span>
     <li><span class="dfn-paneled" id="term-for-task-source" style="color:initial">task source</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-forgiving-base64-encode" style="color:initial">forgiving-base64 encode</span>
     <li><span class="dfn-paneled" id="term-for-isomorphic-encode" style="color:initial">isomorphic encode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-url-fragment" style="color:initial">fragment</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-host" style="color:initial">host</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-origin" style="color:initial">origin</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-port" style="color:initial">port</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-scheme" style="color:initial">scheme</span>
     <li><span class="dfn-paneled" id="term-for-concept-url" style="color:initial">url</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-parser" style="color:initial">url parser</span>
     <li><span class="dfn-paneled" id="term-for-concept-url①" style="color:initial">url record</span>
     <li><span class="dfn-paneled" id="term-for-concept-url-serializer" style="color:initial">url serializer</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-ArrayBuffer" style="color:initial">ArrayBuffer</span>
     <li><span class="dfn-paneled" id="term-for-ArrayBufferView" style="color:initial">ArrayBufferView</span>
     <li><span class="dfn-paneled" id="term-for-BufferSource" style="color:initial">BufferSource</span>
     <li><span class="dfn-paneled" id="term-for-Clamp" style="color:initial">Clamp</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMException" style="color:initial">DOMException</span>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString" style="color:initial">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-Exposed" style="color:initial">Exposed</span>
     <li><span class="dfn-paneled" id="term-for-invalidaccesserror" style="color:initial">InvalidAccessError</span>
     <li><span class="dfn-paneled" id="term-for-invalidstateerror" style="color:initial">InvalidStateError</span>
     <li><span class="dfn-paneled" id="term-for-syntaxerror" style="color:initial">SyntaxError</span>
     <li><span class="dfn-paneled" id="term-for-idl-USVString" style="color:initial">USVString</span>
     <li><span class="dfn-paneled" id="term-for-idl-boolean" style="color:initial">boolean</span>
     <li><span class="dfn-paneled" id="term-for-idl-undefined" style="color:initial">undefined</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-long-long" style="color:initial">unsigned long long</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-short" style="color:initial">unsigned short</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WSP]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-page-66:~:text=_A%20WebSocket%20Message%20Has%20Been%20Received_" style="color:initial">a websocket message has been received</span>
     <li><span class="dfn-paneled" id="term-for-page-41:~:text=closed-,_cleanly_." style="color:initial">cleanly</span>
     <li><span class="dfn-paneled" id="term-for-section-7.1.1" style="color:initial">close the websocket connection</span>
     <li><span class="dfn-paneled" id="term-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and" style="color:initial">established</span>
     <li><span class="dfn-paneled" id="term-for-page-19:~:text=_The%20WebSocket%20Connection%20is%20Established_,-and①" style="color:initial">extensions in use</span>
     <li><span class="dfn-paneled" id="term-for-section-11.3.4" style="color:initial">sec-websocket-protocol</span>
     <li><span class="dfn-paneled" id="term-for-page-66:~:text=needs%20to-,_Send%20a%20WebSocket%20Message_" style="color:initial">send a websocket message</span>
     <li><span class="dfn-paneled" id="term-for-section-7.1.2" style="color:initial">start the websocket closing handshake</span>
     <li><span class="dfn-paneled" id="term-for-page-19:~:text=_Subprotocol%20In,Use_" style="color:initial">subprotocol in use</span>
     <li><span class="dfn-paneled" id="term-for-section-7.1.3" style="color:initial">the websocket closing handshake is started</span>
     <li><span class="dfn-paneled" id="term-for-section-7.1.5" style="color:initial">the websocket connection close code</span>
     <li><span class="dfn-paneled" id="term-for-section-7.1.6" style="color:initial">the websocket connection close reason</span>
     <li><span class="dfn-paneled" id="term-for-section-7.1.4" style="color:initial">the websocket connection is closed</span>
     <li><span class="dfn-paneled" id="term-for-section-11.1.1" style="color:initial">ws</span>
     <li><span class="dfn-paneled" id="term-for-section-11.1.2" style="color:initial">wss</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/">DOM Standard</a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-encoding">[ENCODING]
   <dd>Anne van Kesteren. <a href="https://encoding.spec.whatwg.org/">Encoding Standard</a>. Living Standard. URL: <a href="https://encoding.spec.whatwg.org/">https://encoding.spec.whatwg.org/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch Standard</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-fileapi">[FILEAPI]
   <dd>Marijn Kruisselbrink; Arun Ranganathan. <a href="https://w3c.github.io/FileAPI/">File API</a>. URL: <a href="https://w3c.github.io/FileAPI/">https://w3c.github.io/FileAPI/</a>
   <dt id="biblio-hsts">[HSTS]
   <dd>J. Hodges; C. Jackson; A. Barth. <a href="https://tools.ietf.org/html/rfc6797">HTTP Strict Transport Security (HSTS)</a>. November 2012. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6797">https://tools.ietf.org/html/rfc6797</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/">Infra Standard</a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-unicode">[UNICODE]
   <dd><a href="https://www.unicode.org/versions/latest/">The Unicode Standard</a>. URL: <a href="https://www.unicode.org/versions/latest/">https://www.unicode.org/versions/latest/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL Standard</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
   <dt id="biblio-wsp">[WSP]
   <dd>I. Fette; A. Melnikov. <a href="https://tools.ietf.org/html/rfc6455">The WebSocket Protocol</a>. December 2011. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6455">https://tools.ietf.org/html/rfc6455</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>enum</c-> <a href="#enumdef-binarytype"><code><c- g>BinaryType</c-></code></a> { <a href="#dom-binarytype-blob"><code><c- s>"blob"</c-></code></a>, <a href="#dom-binarytype-arraybuffer"><code><c- s>"arraybuffer"</c-></code></a> };

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#websocket"><code><c- g>WebSocket</c-></code></a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#eventtarget"><c- n>EventTarget</c-></a> {
  <a class="idl-code" data-link-type="constructor" href="#dom-websocket-websocket"><c- g>constructor</c-></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a href="#dom-websocket-websocket-url-protocols-url"><code><c- g>url</c-></code></a>, <c- b>optional</c-> (<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <c- b>or</c-> <c- b>sequence</c->&lt;<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a>>) <a href="#dom-websocket-websocket-url-protocols-protocols"><code><c- g>protocols</c-></code></a> = []);
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="USVString" href="#dom-websocket-url"><c- g>url</c-></a>;

  // ready state
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a href="#dom-websocket-connecting"><code><c- g>CONNECTING</c-></code></a> = 0;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a href="#dom-websocket-open"><code><c- g>OPEN</c-></code></a> = 1;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a href="#dom-websocket-closing"><code><c- g>CLOSING</c-></code></a> = 2;
  <c- b>const</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a href="#dom-websocket-closed"><code><c- g>CLOSED</c-></code></a> = 3;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned short" href="#dom-websocket-readystate"><c- g>readyState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-long-long"><c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned long long" href="#dom-websocket-bufferedamount"><c- g>bufferedAmount</c-></a>;

  // networking
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onopen"><c- g>onopen</c-></a>;
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onerror"><c- g>onerror</c-></a>;
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onclose"><c- g>onclose</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-websocket-extensions"><c- g>extensions</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="DOMString" href="#dom-websocket-protocol"><c- g>protocol</c-></a>;
  <a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-undefined"><c- n>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-websocket-close"><c- g>close</c-></a>(<c- b>optional</c-> [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Clamp"><c- g>Clamp</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a href="#dom-websocket-close-code-reason-code"><code><c- g>code</c-></code></a>, <c- b>optional</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a href="#dom-websocket-close-code-reason-reason"><code><c- g>reason</c-></code></a>);

  // messaging
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler"><c- n>EventHandler</c-></a> <a class="idl-code" data-link-type="attribute" data-type="EventHandler" href="#dom-websocket-onmessage"><c- g>onmessage</c-></a>;
  <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="#enumdef-binarytype"><c- n>BinaryType</c-></a> <a class="idl-code" data-link-type="attribute" data-type="BinaryType" href="#dom-websocket-binarytype"><c- g>binaryType</c-></a>;
  <a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-undefined"><c- n>undefined</c-></a> <a class="idl-code" data-link-type="method" href="#dom-websocket-send"><c- g>send</c-></a>((<a class="n" data-link-type="idl-name" href="https://heycam.github.io/webidl/#BufferSource"><c- n>BufferSource</c-></a> <c- b>or</c-> <a class="n" data-link-type="idl-name" href="https://w3c.github.io/FileAPI/#dfn-Blob"><c- n>Blob</c-></a> <c- b>or</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a>) <a href="#dom-websocket-send-data-data"><code><c- g>data</c-></code></a>);
};

[<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#Exposed"><c- g>Exposed</c-></a>=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <a href="#closeevent"><code><c- g>CloseEvent</c-></code></a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#event"><c- n>Event</c-></a> {
  <a href="#dom-closeevent-closeevent"><code><c- g>constructor</c-></code></a>(<a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a href="#dom-closeevent-closeevent-type-eventinitdict-type"><code><c- g>type</c-></code></a>, <c- b>optional</c-> <a class="n" data-link-type="idl-name" href="#dictdef-closeeventinit"><c- n>CloseEventInit</c-></a> <a href="#dom-closeevent-closeevent-type-eventinitdict-eventinitdict"><code><c- g>eventInitDict</c-></code></a> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean"><c- b>boolean</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="boolean" href="#dom-closeevent-wasclean"><c- g>wasClean</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="unsigned short" href="#dom-closeevent-code"><c- g>code</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a class="idl-code" data-link-type="attribute" data-readonly data-type="USVString" href="#dom-closeevent-reason"><c- g>reason</c-></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-closeeventinit"><code><c- g>CloseEventInit</c-></code></a> : <a class="n" data-link-type="idl-name" href="https://dom.spec.whatwg.org/#dictdef-eventinit"><c- n>EventInit</c-></a> {
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-boolean"><c- b>boolean</c-></a> <a data-default="false" data-type="boolean " href="#dom-closeeventinit-wasclean"><code><c- g>wasClean</c-></code></a> = <c- b>false</c->;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a data-default="0" data-type="unsigned short " href="#dom-closeeventinit-code"><code><c- g>code</c-></code></a> = 0;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-USVString"><c- b>USVString</c-></a> <a data-default="&quot;&quot;" data-type="USVString " href="#dom-closeeventinit-reason"><code><c- g>reason</c-></code></a> = "";
};

</pre>
  <aside class="dfn-panel" data-for="concept-websocket-connection-obtain">
   <b><a href="#concept-websocket-connection-obtain">#concept-websocket-connection-obtain</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-websocket-connection-obtain">2.1. Connections</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="concept-websocket-establish">
   <b><a href="#concept-websocket-establish">#concept-websocket-establish</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-websocket-establish">3.1. Interface definition</a> <a href="#ref-for-concept-websocket-establish①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="fail-the-websocket-connection">
   <b><a href="#fail-the-websocket-connection">#fail-the-websocket-connection</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-fail-the-websocket-connection">2.2. Opening handshake</a> <a href="#ref-for-fail-the-websocket-connection①">(2)</a> <a href="#ref-for-fail-the-websocket-connection②">(3)</a>
    <li><a href="#ref-for-fail-the-websocket-connection③">3.1. Interface definition</a> <a href="#ref-for-fail-the-websocket-connection④">(2)</a> <a href="#ref-for-fail-the-websocket-connection⑤">(3)</a> <a href="#ref-for-fail-the-websocket-connection⑥">(4)</a>
    <li><a href="#ref-for-fail-the-websocket-connection⑦">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="the-websocket-connection-is-established">
   <b><a href="#the-websocket-connection-is-established">#the-websocket-connection-is-established</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-websocket-connection-is-established">2.2. Opening handshake</a>
    <li><a href="#ref-for-the-websocket-connection-is-established①">3.1. Interface definition</a> <a href="#ref-for-the-websocket-connection-is-established②">(2)</a> <a href="#ref-for-the-websocket-connection-is-established③">(3)</a> <a href="#ref-for-the-websocket-connection-is-established④">(4)</a> <a href="#ref-for-the-websocket-connection-is-established⑤">(5)</a> <a href="#ref-for-the-websocket-connection-is-established⑥">(6)</a> <a href="#ref-for-the-websocket-connection-is-established⑦">(7)</a>
    <li><a href="#ref-for-the-websocket-connection-is-established⑧">4. Feedback from the protocol</a> <a href="#ref-for-the-websocket-connection-is-established⑨">(2)</a>
    <li><a href="#ref-for-the-websocket-connection-is-established①⓪">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="enumdef-binarytype">
   <b><a href="#enumdef-binarytype">#enumdef-binarytype</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-binarytype">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="websocket">
   <b><a href="#websocket">#websocket</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-websocket">3. The WebSocket interface</a>
    <li><a href="#ref-for-websocket①">3.1. Interface definition</a> <a href="#ref-for-websocket②">(2)</a> <a href="#ref-for-websocket③">(3)</a> <a href="#ref-for-websocket④">(4)</a> <a href="#ref-for-websocket⑤">(5)</a> <a href="#ref-for-websocket⑥">(6)</a> <a href="#ref-for-websocket⑦">(7)</a> <a href="#ref-for-websocket⑧">(8)</a> <a href="#ref-for-websocket⑨">(9)</a> <a href="#ref-for-websocket①⑤">(10)</a> <a href="#ref-for-websocket①⑥">(11)</a>
    <li><a href="#ref-for-websocket①⓪">4. Feedback from the protocol</a> <a href="#ref-for-websocket①①">(2)</a> <a href="#ref-for-websocket①②">(3)</a> <a href="#ref-for-websocket①③">(4)</a> <a href="#ref-for-websocket①④">(5)</a>
    <li><a href="#ref-for-websocket①⑦">6. The CloseEvent interface</a>
    <li><a href="#ref-for-websocket①⑧">7. Garbage collection</a> <a href="#ref-for-websocket①⑨">(2)</a> <a href="#ref-for-websocket②⓪">(3)</a> <a href="#ref-for-websocket②①">(4)</a> <a href="#ref-for-websocket②②">(5)</a> <a href="#ref-for-websocket②③">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-connecting">
   <b><a href="#dom-websocket-connecting">#dom-websocket-connecting</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-connecting">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-closing">
   <b><a href="#dom-websocket-closing">#dom-websocket-closing</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-closing">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-closing①">(2)</a> <a href="#ref-for-dom-websocket-closing②">(3)</a> <a href="#ref-for-dom-websocket-closing③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-closed">
   <b><a href="#dom-websocket-closed">#dom-websocket-closed</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-closed">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="url">
   <b><a href="#url">#url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-url">3.1. Interface definition</a> <a href="#ref-for-url①">(2)</a> <a href="#ref-for-url②">(3)</a>
    <li><a href="#ref-for-url③">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-websocket">
   <b><a href="#dom-websocket-websocket">#dom-websocket-websocket</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-websocket">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-websocket①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-url">
   <b><a href="#dom-websocket-url">#dom-websocket-url</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-url">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-url①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-readystate">
   <b><a href="#dom-websocket-readystate">#dom-websocket-readystate</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-readystate">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-readystate①">(2)</a> <a href="#ref-for-dom-websocket-readystate②">(3)</a> <a href="#ref-for-dom-websocket-readystate③">(4)</a> <a href="#ref-for-dom-websocket-readystate④">(5)</a> <a href="#ref-for-dom-websocket-readystate⑤">(6)</a> <a href="#ref-for-dom-websocket-readystate⑥">(7)</a> <a href="#ref-for-dom-websocket-readystate⑦">(8)</a> <a href="#ref-for-dom-websocket-readystate①⓪">(9)</a> <a href="#ref-for-dom-websocket-readystate①①">(10)</a> <a href="#ref-for-dom-websocket-readystate①②">(11)</a>
    <li><a href="#ref-for-dom-websocket-readystate⑧">4. Feedback from the protocol</a> <a href="#ref-for-dom-websocket-readystate⑨">(2)</a>
    <li><a href="#ref-for-dom-websocket-readystate①③">7. Garbage collection</a> <a href="#ref-for-dom-websocket-readystate①④">(2)</a> <a href="#ref-for-dom-websocket-readystate①⑤">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="connecting">
   <b><a href="#connecting">#connecting</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-connecting">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="open">
   <b><a href="#open">#open</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-open">4. Feedback from the protocol</a> <a href="#ref-for-open①">(2)</a>
    <li><a href="#ref-for-open②">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="closing">
   <b><a href="#closing">#closing</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-closing">3.1. Interface definition</a> <a href="#ref-for-closing①">(2)</a>
    <li><a href="#ref-for-closing②">7. Garbage collection</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="closed">
   <b><a href="#closed">#closed</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-closed">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-extensions">
   <b><a href="#dom-websocket-extensions">#dom-websocket-extensions</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-extensions">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-extensions①">(2)</a>
    <li><a href="#ref-for-dom-websocket-extensions②">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-protocol">
   <b><a href="#dom-websocket-protocol">#dom-websocket-protocol</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-protocol">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-protocol①">(2)</a>
    <li><a href="#ref-for-dom-websocket-protocol②">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-close">
   <b><a href="#dom-websocket-close">#dom-websocket-close</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-close">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-close①">(2)</a> <a href="#ref-for-dom-websocket-close②">(3)</a> <a href="#ref-for-dom-websocket-close③">(4)</a> <a href="#ref-for-dom-websocket-close④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-bufferedamount">
   <b><a href="#dom-websocket-bufferedamount">#dom-websocket-bufferedamount</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-bufferedamount">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-bufferedamount①">(2)</a> <a href="#ref-for-dom-websocket-bufferedamount②">(3)</a> <a href="#ref-for-dom-websocket-bufferedamount③">(4)</a> <a href="#ref-for-dom-websocket-bufferedamount④">(5)</a> <a href="#ref-for-dom-websocket-bufferedamount⑤">(6)</a> <a href="#ref-for-dom-websocket-bufferedamount⑥">(7)</a> <a href="#ref-for-dom-websocket-bufferedamount⑦">(8)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-binarytype">
   <b><a href="#dom-websocket-binarytype">#dom-websocket-binarytype</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-binarytype">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-binarytype①">(2)</a> <a href="#ref-for-dom-websocket-binarytype②">(3)</a>
    <li><a href="#ref-for-dom-websocket-binarytype③">4. Feedback from the protocol</a> <a href="#ref-for-dom-websocket-binarytype④">(2)</a> <a href="#ref-for-dom-websocket-binarytype⑤">(3)</a> <a href="#ref-for-dom-websocket-binarytype⑥">(4)</a> <a href="#ref-for-dom-websocket-binarytype⑦">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-send">
   <b><a href="#dom-websocket-send">#dom-websocket-send</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-send">3.1. Interface definition</a> <a href="#ref-for-dom-websocket-send①">(2)</a> <a href="#ref-for-dom-websocket-send②">(3)</a> <a href="#ref-for-dom-websocket-send③">(4)</a> <a href="#ref-for-dom-websocket-send④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-onopen">
   <b><a href="#dom-websocket-onopen">#dom-websocket-onopen</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-onopen">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-onmessage">
   <b><a href="#dom-websocket-onmessage">#dom-websocket-onmessage</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-onmessage">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-onerror">
   <b><a href="#dom-websocket-onerror">#dom-websocket-onerror</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-onerror">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-websocket-onclose">
   <b><a href="#dom-websocket-onclose">#dom-websocket-onclose</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-websocket-onclose">3.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="blob">
   <b><a href="#blob">#blob</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-blob">3.1. Interface definition</a> <a href="#ref-for-blob①">(2)</a> <a href="#ref-for-blob②">(3)</a>
    <li><a href="#ref-for-blob③">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="arraybuffer">
   <b><a href="#arraybuffer">#arraybuffer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-arraybuffer">3.1. Interface definition</a> <a href="#ref-for-arraybuffer①">(2)</a>
    <li><a href="#ref-for-arraybuffer②">4. Feedback from the protocol</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="flagged-as-full">
   <b><a href="#flagged-as-full">#flagged-as-full</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-flagged-as-full">3.1. Interface definition</a> <a href="#ref-for-flagged-as-full①">(2)</a> <a href="#ref-for-flagged-as-full②">(3)</a> <a href="#ref-for-flagged-as-full③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="closeevent">
   <b><a href="#closeevent">#closeevent</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-closeevent">3.1. Interface definition</a>
    <li><a href="#ref-for-closeevent①">6. The CloseEvent interface</a> <a href="#ref-for-closeevent②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-closeeventinit">
   <b><a href="#dictdef-closeeventinit">#dictdef-closeeventinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-closeeventinit">6. The CloseEvent interface</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-closeevent-wasclean">
   <b><a href="#dom-closeevent-wasclean">#dom-closeevent-wasclean</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-closeevent-wasclean">3.1. Interface definition</a>
    <li><a href="#ref-for-dom-closeevent-wasclean①">6. The CloseEvent interface</a> <a href="#ref-for-dom-closeevent-wasclean②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-closeevent-code">
   <b><a href="#dom-closeevent-code">#dom-closeevent-code</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-closeevent-code">3.1. Interface definition</a>
    <li><a href="#ref-for-dom-closeevent-code①">6. The CloseEvent interface</a> <a href="#ref-for-dom-closeevent-code②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-closeevent-reason">
   <b><a href="#dom-closeevent-reason">#dom-closeevent-reason</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-closeevent-reason">3.1. Interface definition</a>
    <li><a href="#ref-for-dom-closeevent-reason①">6. The CloseEvent interface</a> <a href="#ref-for-dom-closeevent-reason②">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s| )+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>